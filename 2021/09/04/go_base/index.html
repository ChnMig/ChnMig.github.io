<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>go 基础笔记存档 - ChnMig的个人网站</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="ChnMig的个人网站"><meta name="msapplication-TileImage" content="/images/logo.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ChnMig的个人网站"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="这是初学的时候写的笔记, 之前保存到印象笔记, 后来保存到博客园, 到现在, 转到自己的博客做个备份吧"><meta property="og:type" content="blog"><meta property="og:title" content="go 基础笔记存档"><meta property="og:url" content="https://www.chnmig.com/2021/09/04/go_base/"><meta property="og:site_name" content="ChnMig的个人网站"><meta property="og:description" content="这是初学的时候写的笔记, 之前保存到印象笔记, 后来保存到博客园, 到现在, 转到自己的博客做个备份吧"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172216369-649555803.png"><meta property="og:image" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172314114-1899805474.png"><meta property="og:image" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172407173-2015921684.png"><meta property="og:image" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172446179-127845015.png"><meta property="og:image" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172529101-72359284.png"><meta property="og:image" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172726781-1327299399.png"><meta property="og:image" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172850342-877493789.png"><meta property="og:image" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172923017-638428184.png"><meta property="og:image" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172948498-163058279.png"><meta property="article:published_time" content="2021-09-03T16:00:00.000Z"><meta property="article:modified_time" content="2021-09-03T16:00:00.000Z"><meta property="article:author" content="ChnMig"><meta property="article:tag" content="Golang"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172216369-649555803.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.chnmig.com/2021/09/04/go_base/"},"headline":"go 基础笔记存档","image":["https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172216369-649555803.png","https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172314114-1899805474.png","https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172407173-2015921684.png","https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172446179-127845015.png","https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172529101-72359284.png","https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172726781-1327299399.png","https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172850342-877493789.png","https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172923017-638428184.png","https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172948498-163058279.png"],"datePublished":"2021-09-03T16:00:00.000Z","dateModified":"2021-09-03T16:00:00.000Z","author":{"@type":"Person","name":"ChnMig"},"publisher":{"@type":"Organization","name":"ChnMig的个人网站","logo":{"@type":"ImageObject","url":"https://www.chnmig.com/images/logo.gif"}},"description":"这是初学的时候写的笔记, 之前保存到印象笔记, 后来保存到博客园, 到现在, 转到自己的博客做个备份吧"}</script><link rel="canonical" href="https://www.chnmig.com/2021/09/04/go_base/"><link rel="icon" href="/images/logo.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?8c2572cbfe4082d1fcd1327e4614cf34";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo.gif" alt="ChnMig的个人网站" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">类别</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a><a class="navbar-item" target="_blank" rel="noopener" href="https://tongji.baidu.com/web/welcome/ico?s=8c2572cbfe4082d1fcd1327e4614cf34">访问统计</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-09-03T16:00:00.000Z" title="2021/9/4 00:00:00">2021-09-04</time>发表</span><span class="level-item"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></span><span class="level-item">2 小时读完 (大约18101个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">go 基础笔记存档</h1><div class="content"><h2 id="前言-3">前言</h2>
<p>考虑到印象笔记以后不续费了,这里转存到博客园一份<br>
因内容是自己写的笔记, 未作任何润色, 所以看着很精简, 请见谅</p>
<h2 id="查看官方文档">查看官方文档</h2>
<p>在新的go安装包中,为了减小体积默认去除了go doc</p>
<p>安装go语言后在DOS中输入</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">godoc -http=:<span class="number">9000</span></span><br></pre></td></tr></tbody></table></figure>
<p>然后在浏览器中打开 127.0.0.1:9000 即可(不能关闭DOS)</p>
<h2 id="该系列参照了大佬的学习路线-加上本人的代码实践-大佬链接">该系列参照了大佬的学习路线,加上本人的代码实践,大佬链接</h2>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/go_menu">https://www.liwenzhou.com/posts/Go/go_menu</a></p>
<h2 id="目录结构">目录结构</h2>
<p>GOPATH &gt; src 代码(pkg包/bin编译后文件) &gt; 域名 &gt; 用户名 &gt; 项目 &gt; 模块</p>
<h2 id="双引号单引号">双引号单引号</h2>
<p>单引号代表字符 &gt; ‘a’</p>
<p>双引号代表字符串 &gt; “abcd”</p>
<blockquote>
<p>中文最少3位所以只能用双引号</p>
</blockquote>
<h2 id="编译代码">编译代码</h2>
<p>进入目录(项目)</p>
<p>go build -o 文件名</p>
<h2 id="main-go">main.go</h2>
<p>main.go是项目主入口</p>
<h2 id="调试代码">调试代码</h2>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> run 文件</span><br></pre></td></tr></tbody></table></figure>
<h2 id="设置生成文件的格式-跨平台">设置生成文件的格式(跨平台)</h2>
<h4 id="命令行">命令行</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成linux可执行文件</span></span><br><span class="line">SET CGO_ENABLED=<span class="number">0</span>  <span class="comment">//禁用CGO</span></span><br><span class="line">SET GOOS=linux  <span class="comment">//设置目标平台为linux</span></span><br><span class="line">SET GOARCH=amd64  <span class="comment">//目标架构为amd64</span></span><br><span class="line"><span class="comment">// 生成win</span></span><br><span class="line">SET GOOS=windows</span><br><span class="line"><span class="comment">// 生成mac</span></span><br><span class="line">SET GOOS=darwin</span><br></pre></td></tr></tbody></table></figure>
<h2 id="git控制">git控制</h2>
<p>只需控制 src 下即可</p>
<h2 id="变量">变量</h2>
<blockquote>
<p>变量声明后必须使用不然编译失败</p>
<p>变量可以重复赋值但是无法赋值其他变量类型</p>
<p>变量声明在函数外代表该文件的全局变量</p>
<p>在同一个作用域内不能重复声明同名变量</p>
<p>变量声明后的操作只能在函数中写</p>
</blockquote>
<h4 id="引用类型和值类型">引用类型和值类型</h4>
<p>引用类型空值为 niu<br>
值类型空就为空</p>
<h4 id="声明单个变量">声明单个变量</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> 变量名 变量类型</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>变量声明后必须要使用不然编译失败</p>
</blockquote>
<h4 id="声明多个变量">声明多个变量</h4>
<p>声明多个变量</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var (</span><br><span class="line">	变量名 变量类型</span><br><span class="line">	变量名 变量类型</span><br><span class="line">	...</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="变量默认值">变量默认值</h4>
<p>命令变量后有默认值</p>
<blockquote>
<p>string - “”</p>
<p>int - 0</p>
<p>bool - false</p>
</blockquote>
<h4 id="变量声明时指定值">变量声明时指定值</h4>
<p>创建变量时指定值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> 变量名 变量类型 = 值</span><br></pre></td></tr></tbody></table></figure>
<h4 id="声明变量时直接指定变量类型">声明变量时直接指定变量类型</h4>
<p>自动识别值的类型并指定变量类型</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var 变量名 = 值</span><br></pre></td></tr></tbody></table></figure>
<h2 id="fmt模块">fmt模块</h2>
<p>打印输出</p>
<h4 id="导入">导入</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="带换行输出">带换行输出</h4>
<p>可换行</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println()</span><br></pre></td></tr></tbody></table></figure>
<h4 id="格式化-带换行-输出">格式化(带换行)输出</h4>
<p>可加 %s 等占位</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Printf()</span><br></pre></td></tr></tbody></table></figure>
<h2 id="短变量声明">短变量声明</h2>
<p>在[函数内部]声明只能在该函数内使用的变量</p>
<h4 id="声明短变量">声明短变量</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">变量名 := 值</span><br></pre></td></tr></tbody></table></figure>
<p>等同于</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> 变量名 变量类型 = 值</span><br></pre></td></tr></tbody></table></figure>
<h2 id="函数返回值">函数返回值</h2>
<p>return返回</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span>(返回值<span class="number">1</span>类型, 返回值<span class="number">2</span>类型, ...){</span><br><span class="line">	<span class="keyword">return</span> 返回值<span class="number">1</span>, 返回值<span class="number">2</span>, ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="匿名变量">匿名变量</h2>
<p>接收不需要的值</p>
<blockquote>
<p>例如函数a返回两个值,我们只需要值1,但是我们调用该函数必须要接受2个值</p>
<p>如果我们接收值2而不使用则会 编译失败(定义变量而不使用)</p>
<p>此时可以将值2设为匿名变量</p>
<p>匿名变量可以重复声明</p>
<p>常量中也可以声明匿名变量</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span>(<span class="type">string</span>, <span class="type">int</span>){</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"aa"</span>, <span class="number">500</span></span><br><span class="line">}</span><br><span class="line">name, _ := foo()</span><br></pre></td></tr></tbody></table></figure>
<p>此时我们使用匿名变量占位</p>
<h2 id="常量">常量</h2>
<blockquote>
<p>一旦赋值不可更改</p>
<p>常量在定义时必须赋值</p>
<p>如没有赋值就和上一行一样(必须结构与上一行一样不然报错)</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> 常量名 = 值</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	常量名<span class="number">1</span> = 值<span class="number">1</span></span><br><span class="line">	常量名<span class="number">2</span> = 值<span class="number">2</span></span><br><span class="line">	常量名<span class="number">3</span>  <span class="comment">// 如不赋值默认拿上一行的值</span></span><br><span class="line">	常量名<span class="number">4</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>(</span><br><span class="line">	a, b = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">	c, d  <span class="comment">// 1, 2</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="枚举">枚举</h2>
<blockquote>
<p>iota</p>
<p>常量计数器,只能在常量表达式中使用</p>
<p>在一个 const 中,初始值是0, 声明一个常量则const+1</p>
<p>每一个 const 中, 都会重新初始化为0</p>
<p>就算某一行定义多个常量 iota也只+1</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	a = <span class="literal">iota</span>  <span class="comment">// 0</span></span><br><span class="line">	b = <span class="literal">iota</span>  <span class="comment">// 1</span></span><br><span class="line">	c = <span class="literal">iota</span>  <span class="comment">// 2</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="经典题目">经典题目</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	a = <span class="literal">iota</span>  <span class="comment">// 初始化0</span></span><br><span class="line">	_ = <span class="literal">iota</span>  <span class="comment">// 声明匿名常量,所以+1</span></span><br><span class="line">	b = <span class="literal">iota</span>  <span class="comment">// 2</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	a = <span class="literal">iota</span>  <span class="comment">// 初始化0</span></span><br><span class="line">	b = <span class="number">100</span>  <span class="comment">// 赋值100</span></span><br><span class="line">	c = <span class="literal">iota</span>  <span class="comment">// 定义两个常量所以为2</span></span><br><span class="line">	d  <span class="comment">// 不定义默认跟上一行也是iota所以为3</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">const</span> e = <span class="literal">iota</span>  <span class="comment">// 初始化0</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	_ = <span class="literal">iota</span>  <span class="comment">// 0</span></span><br><span class="line">    KB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)  <span class="comment">// 1&lt;&lt;10(位运算,2进制向左移10位) == 2的10次方 == 1024</span></span><br><span class="line">	MB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)  <span class="comment">// 2的20次方</span></span><br><span class="line">	GB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)  <span class="comment">// 2的30次方</span></span><br><span class="line">	TB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)</span><br><span class="line">	PB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	a, b = <span class="literal">iota</span> + <span class="number">1</span>, <span class="literal">iota</span> + <span class="number">2</span>  <span class="comment">// iota=0, a=1, b=2</span></span><br><span class="line">	c, d  <span class="comment">// iota=1, c=2, d=3 iota声明常量一行变一次,不判断一行定义几个</span></span><br><span class="line">	e, f  <span class="comment">// iota=2, e=3, f=4</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="数据类型1">数据类型1</h2>
<h4 id="整型">整型</h4>
<blockquote>
<p>int8, int16, int32, int64</p>
<p>int8: 最大8位的二进制数, 最大2的9次方-1</p>
<p>其余类似</p>
<p>在32位系统, int == int32</p>
<p>64位, int == int64</p>
</blockquote>
<blockquote>
<p>unit8, uint16, uint32, uint64</p>
<p>在32位系统, uint == uint32</p>
<p>64位, uint == uint64</p>
</blockquote>
<h4 id="len">len</h4>
<blockquote>
<p>返回对象的长度</p>
</blockquote>
<h4 id="进制">进制</h4>
<blockquote>
<p>Go中,新建变量时,二进制/八进制等等 都可以写成 int</p>
<p>Go会根据特征判断进制</p>
<p>比如 八进制都是以 0 开头</p>
<p>十六进制以 0x 开头</p>
<p>我们想打印出来可以使用 Printf</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	<span class="keyword">var</span> a <span class="type">int</span> = <span class="number">10</span>  <span class="comment">// 二进制</span></span><br><span class="line">	<span class="keyword">var</span> b <span class="type">int</span> = <span class="number">077</span>  <span class="comment">// 八进制</span></span><br><span class="line">	<span class="keyword">var</span> c = <span class="number">0xff</span>  <span class="comment">// 十六进制int可省略,可自己判断</span></span><br><span class="line">	fmt.Println(a, b)  <span class="comment">// 转换成十进制</span></span><br><span class="line">	fmt.Printf(<span class="string">"%b \n"</span>, a)  <span class="comment">// b代表二进制 \n换行</span></span><br><span class="line">	fmt.Printf(<span class="string">"%o \n"</span>, b)  <span class="comment">// n代表八进制</span></span><br><span class="line">	fmt.Printf(<span class="string">"%x \n"</span>, c)  <span class="comment">// x代表十六进制</span></span><br><span class="line">	fmt.Printf(<span class="string">"%p"</span>, &amp;a)  <span class="comment">// 打印数据a的内存地址(十六进制)</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="浮点">浮点</h4>
<blockquote>
<p>浮点数是不准确的(Python: 0.1+0.2 = 0.30000000000000004)</p>
<p>如果涉及到金钱等对小数敏感的业务</p>
<p>不要用浮点数</p>
<p>业内使用较多的两种方法</p>
</blockquote>
<h6 id="方法1">方法1</h6>
<p>将数字转换成字符串进行逻辑编写</p>
<h6 id="方法2">方法2</h6>
<p>将小数变成整数计算后再变成小数</p>
<h2 id="数据类型1-补充">数据类型1(补充)</h2>
<h4 id="布尔">布尔</h4>
<blockquote>
<p>go语言不允许将整形强制转换为布尔型</p>
<p>布尔默认 False</p>
<p>布尔无法参与数值运算,也不能与其他类型转换</p>
</blockquote>
<h4 id="字符串">字符串</h4>
<blockquote>
<p>utf-8编码</p>
</blockquote>
<h4 id="字符串转义">字符串转义</h4>
<p>\r    回车(光标移动至下一行行首)</p>
<p>\n    换行(移动至下一行同样位置)</p>
<p>\t    制表符</p>
<p>\’    单引号</p>
<p>\‘’    双引号</p>
<p>\     反斜杠</p>
<h4 id="多行字符串">多行字符串</h4>
<blockquote>
<p>多行字符串里不存在转义</p>
</blockquote>
<p>`aa</p>
<p>bb</p>
<p>cc</p>
<p>`</p>
<h4 id="字符串常用方法">字符串常用方法</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串操作</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	<span class="comment">// 字符串位数</span></span><br><span class="line">	s1 := <span class="string">"我是字符串1"</span></span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(s1))  <span class="comment">// 字符串位数(s1包含中文返回16)</span></span><br><span class="line">	<span class="comment">// 字符串拼接</span></span><br><span class="line">	s2 := <span class="string">"我是字符串2"</span></span><br><span class="line">	fmt.Println(s1+<span class="string">"affag"</span>+s2)  <span class="comment">// 推荐使用+号</span></span><br><span class="line">	s3 := fmt.Sprintf(<span class="string">"%safaf%s"</span>, s1, s2)  <span class="comment">// Sprintf返回拼接后的字符串</span></span><br><span class="line">	fmt.Println(s3)</span><br><span class="line">	<span class="comment">// 字符串分割</span></span><br><span class="line">	ret := strings.Split(s1, <span class="string">"是"</span>)  <span class="comment">//中文不能单引号</span></span><br><span class="line">	fmt.Println(ret)</span><br><span class="line">	<span class="comment">// 判断是否包含</span></span><br><span class="line">	ret2 := strings.Contains(s1, <span class="string">"是"</span>)</span><br><span class="line">	fmt.Println(ret2)</span><br><span class="line">	<span class="comment">// 判断前缀(第一个字符)</span></span><br><span class="line">	ret3 := strings.HasPrefix(s1, <span class="string">"我"</span>)</span><br><span class="line">	fmt.Println(ret3)</span><br><span class="line">	<span class="comment">// 判断后缀(最后一个字符)</span></span><br><span class="line">	ret4 := strings.HasSuffix(s1, <span class="string">"1"</span>)</span><br><span class="line">	fmt.Println(ret4)</span><br><span class="line">	<span class="comment">// 求子串位置</span></span><br><span class="line">	s4 := <span class="string">"123321"</span></span><br><span class="line">	fmt.Println(strings.Index(s4, <span class="string">"1"</span>))  <span class="comment">// 1在s4中的第一个位置</span></span><br><span class="line">	fmt.Println(strings.LastIndex(s4, <span class="string">"1"</span>))  <span class="comment">// 1的最后一个位置</span></span><br><span class="line">	<span class="comment">// join(合并切片为str)</span></span><br><span class="line">	a1 := []<span class="type">string</span>{<span class="string">"a"</span>, <span class="string">"b"</span>}</span><br><span class="line">	fmt.Println(strings.Join(a1, <span class="string">"-"</span>))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="byte和rune类型">byte和rune类型</h4>
<blockquote>
<p>当我们使用 Println 输出中文时,发现打出来的是一串数字,例如 “中文” 打印出来是 20013 ,实际上是字符串对应的 ASCII 码</p>
<p>当我们使用 len 函数求字符串的长度时,要格外注意,在 UTF8 中中文最少占用3个字节</p>
<p>一个字节等于8位(bit)</p>
</blockquote>
<p>byte类型, (unit8类型), 代表 ASCII码, 英文这种占一个字节的字符</p>
<p>rune类型, (int32), 代表UTF8, 中文/日文等复合字符</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	s1 := <span class="string">"ChnMig"</span></span><br><span class="line">	c1 := <span class="string">'A'</span></span><br><span class="line">	fmt.Println(s1, c1)</span><br><span class="line">	s2 := <span class="string">"中文"</span></span><br><span class="line">	c2 := <span class="string">'中'</span></span><br><span class="line">	fmt.Println(s2, c2)</span><br><span class="line">	fmt.Println(c2)</span><br><span class="line"></span><br><span class="line">	s3 := <span class="string">"Hello,中国"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 遍历字符串</span></span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="built_in">len</span>(s3);i++{</span><br><span class="line">		fmt.Printf(<span class="string">"%c\n"</span>, s3[i])  <span class="comment">// 中文乱码</span></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// for range 不乱码</span></span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> s3{</span><br><span class="line">		fmt.Printf(<span class="string">"%d%c\n"</span>, k, v)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="类型强制转换">类型强制转换</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 强制类型转换</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	s1 := <span class="string">"big"</span>  <span class="comment">// 建立s1</span></span><br><span class="line">	ByteArray := []<span class="type">byte</span>(s1) <span class="comment">// 建立一个存放类型为byte的列表将s1赋值进去(赋值时会强制转换为byte)</span></span><br><span class="line">	ByteArray[<span class="number">0</span>] = <span class="string">'p'</span>  <span class="comment">// 按索引修改</span></span><br><span class="line">	s1 = <span class="type">string</span>(ByteArray)  <span class="comment">// 转换为str重新赋值给s1</span></span><br><span class="line">	fmt.Println(s1)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="流程控制">流程控制</h2>
<h4 id="if">if</h4>
<blockquote>
<p>在if中也可以写赋值语句</p>
<p>if age := 18{</p>
<p>​    …</p>
<p>}</p>
<p>注意此处 age 变量作用域只在该if语句中</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// if/ else if</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	age := <span class="number">19</span></span><br><span class="line">	<span class="keyword">if</span> age &gt; <span class="number">18</span>{</span><br><span class="line">		fmt.Println(<span class="string">"18+"</span>)</span><br><span class="line">	}<span class="keyword">else</span> <span class="keyword">if</span> age &lt; <span class="number">18</span>{  <span class="comment">// else, else if 不能再换行写</span></span><br><span class="line">		fmt.Println(<span class="string">"FBI WARING"</span>)</span><br><span class="line">	}<span class="keyword">else</span> {</span><br><span class="line">		fmt.Println(<span class="number">18</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"> </span><br></pre></td></tr></tbody></table></figure>
<h4 id="for">for</h4>
<blockquote>
<p>for 初始语句;条件表达式;结束语句{</p>
<p>​    循环体语句</p>
<p>}</p>
<p>初始语句和结束语句可以省略</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始语句结束语句省略</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	age := <span class="number">18</span></span><br><span class="line">	<span class="keyword">for</span> age &gt; <span class="number">0</span>{</span><br><span class="line">		fmt.Println(age)</span><br><span class="line">		age--</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 完整版</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	<span class="keyword">for</span> age:=<span class="number">18</span>;age &gt; <span class="number">0</span>;age--{</span><br><span class="line">		fmt.Println(age)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 死循环</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	<span class="keyword">for</span> {</span><br><span class="line">		<span class="comment">//死循环(慎用)</span></span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="switch">switch</h4>
<blockquote>
<p>简略判断</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// switch</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	age := <span class="number">18</span></span><br><span class="line">	<span class="keyword">switch</span> age {  <span class="comment">// switch 要判断的值</span></span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:  <span class="comment">// 判断</span></span><br><span class="line">		fmt.Println(<span class="string">"1"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="number">18</span>:  <span class="comment">// 判断</span></span><br><span class="line">		fmt.Println(<span class="string">"18"</span>)</span><br><span class="line">	<span class="keyword">default</span>:  <span class="comment">// 以上判断都不符合</span></span><br><span class="line">		fmt.Println(<span class="string">"以上判断全都不符合"</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>switch 也可以一次判断多个</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// switch</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	age := <span class="number">18</span></span><br><span class="line">	<span class="keyword">switch</span> age {</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>:  <span class="comment">// 判断</span></span><br><span class="line">		fmt.Println(<span class="string">"1"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>:  <span class="comment">// 判断</span></span><br><span class="line">		fmt.Println(<span class="string">"18"</span>)</span><br><span class="line">	<span class="keyword">default</span>:  <span class="comment">// 以上判断都不符合</span></span><br><span class="line">		fmt.Println(<span class="string">"以上判断全都不符合"</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>也可以在case里比较</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// switch</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">	age := <span class="number">18</span></span><br><span class="line">	<span class="keyword">switch</span> {</span><br><span class="line">	<span class="keyword">case</span> age &lt; <span class="number">25</span>:</span><br><span class="line">		fmt.Println(<span class="string">"&gt;25"</span>)</span><br><span class="line">	<span class="keyword">case</span> age &gt; <span class="number">25</span>:</span><br><span class="line">		fmt.Println(<span class="string">"&lt;25"</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="break-和-continue">break 和 continue</h4>
<blockquote>
<p>break 终止循环/遍历</p>
<p>continue 跳出一次循环/遍历</p>
</blockquote>
<h2 id="fmt模块-2">fmt模块</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/go_fmt/">https://www.liwenzhou.com/posts/Go/go_fmt/</a></p>
</blockquote>
<h4 id="println">println</h4>
<blockquote>
<p>行内输出</p>
</blockquote>
<h4 id="printf">printf</h4>
<blockquote>
<p>带格式化参数输出</p>
<p>%d  整数</p>
<p>%.2f  小数(精确小数点两位)</p>
<p>%v  万能</p>
<p>%T  变量类型</p>
<p>%%  一个%</p>
</blockquote>
<h2 id="数组">数组</h2>
<blockquote>
<p>数据类型元素的集合, 在定义时指定数据类型,不可插入其他的数据类型</p>
<p>数组可修改,但是数组长度无法改变</p>
<p>数组的数据库类型是长度+类型,所以两个数组长度不一致则数据类型不一致</p>
<p>数组是 值类型 的,如果将数组a赋值给数组b, 再更改数组a中的值数组b不会更改, 等同于Python的深Copy</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a := [<span class="number">5</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>}</span><br><span class="line">	b := [<span class="number">10</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>} <span class="comment">//定义10位但是只填了两位那之后的默认0</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> c [<span class="number">3</span>]<span class="type">int</span>                   <span class="comment">//用var定义</span></span><br><span class="line">	<span class="keyword">var</span> d [<span class="number">3</span>]<span class="type">int</span> = [<span class="number">3</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>} <span class="comment">//用var定义并赋值</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(d)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="自动判断几位">自动判断几位</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>} <span class="comment">// [...]会自己查询赋值几位然后填充位数</span></span><br><span class="line">	fmt.Println(a)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="根据索引赋值">根据索引赋值</h4>
<blockquote>
<p>如果我们定义长度100的数组第50位为3</p>
<p>a := [100]int{50: 3}</p>
</blockquote>
<h4 id="数组的遍历">数组的遍历</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a := [<span class="number">100</span>]<span class="type">int</span>{<span class="number">50</span>: <span class="number">3</span>}</span><br><span class="line"></span><br><span class="line">	<span class="comment">//通过索引遍历</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(a); i++ {</span><br><span class="line">		fmt.Println(a[i])</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">//通过range遍历</span></span><br><span class="line">	<span class="keyword">for</span> index, value := <span class="keyword">range</span> a {</span><br><span class="line">		fmt.Println(index, value)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="多维数组">多维数组</h2>
<blockquote>
<p>数组套数组…</p>
<p>一个数组是一维</p>
<p>多维数组只有第一层能使用 … 确定长度</p>
<p>多维数组也是 值类型</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">//声明后赋值</span></span><br><span class="line">	<span class="keyword">var</span> a [<span class="number">3</span>][<span class="number">2</span>]<span class="type">int</span> <span class="comment">//[[0, 0] [0, 0] [0, 0]]</span></span><br><span class="line">	a = [<span class="number">3</span>][<span class="number">2</span>]<span class="type">int</span>{</span><br><span class="line">		[<span class="number">2</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>}, <span class="comment">//这里给a的第一位[0, 0]赋值</span></span><br><span class="line">		[<span class="number">2</span>]<span class="type">int</span>{<span class="number">4</span>, <span class="number">5</span>}, <span class="comment">//第二位</span></span><br><span class="line">	}</span><br><span class="line">	fmt.Println(a) <span class="comment">//[[1 2] [4 5] [0 0]]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//声明时赋值</span></span><br><span class="line">	<span class="keyword">var</span> b = [<span class="number">3</span>][<span class="number">2</span>]<span class="type">int</span>{</span><br><span class="line">		[<span class="number">2</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>},</span><br><span class="line">		[<span class="number">2</span>]<span class="type">int</span>{<span class="number">4</span>, <span class="number">5</span>},</span><br><span class="line">	}</span><br><span class="line">	fmt.Println(b)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//多维数组索引</span></span><br><span class="line">	fmt.Println(a[<span class="number">0</span>][<span class="number">0</span>]) <span class="comment">//1</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//多维数组遍历</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; (<span class="built_in">len</span>(a)); i++ {</span><br><span class="line">		<span class="keyword">for</span> k := <span class="number">0</span>; k &lt; (<span class="built_in">len</span>(a[i])); k++ {</span><br><span class="line">			fmt.Println(a[i][k])</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">//range</span></span><br><span class="line">	<span class="keyword">for</span> _, v1 := <span class="keyword">range</span> a {</span><br><span class="line">		<span class="keyword">for</span> _, v2 := <span class="keyword">range</span> v1 {</span><br><span class="line">			fmt.Println(v2)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="切片">切片</h2>
<blockquote>
<p>数组建立时就需要指定长度,长度不可更改</p>
<p>切片和数组一样都只能存储相同数据类型,但是他的长度是可变的</p>
<p>切片是引用类型</p>
<p>引用类型指公用一个内存地址</p>
<p>更改一个值会造成所有共用该地址的值变更</p>
<p>切片有容量的概念,容量代表切片的最大长度,但是是可扩充的</p>
<p>切片初始容量为他生成时的长度</p>
<p>切片如果是由数组产生,那么他的容量为 切片开始处 到 数组结束处 长度</p>
</blockquote>
<p>切片大小: 当前切片长度</p>
<p>切片地址: 切片中第一个元素地址  len()</p>
<p>切片容量: 底层数组最大能存放的元素个数  cap()</p>
<h4 id="切片扩容">切片扩容</h4>
<blockquote>
<p>切片扩容策略是发现不够的情况下每次扩容到前容量的两倍(x2)(不一定,小于1024时是这样,大于1024是1/4)</p>
<p>发现长度超出容量 &gt; 丢弃老内存 &gt; 生成新数组(容量x2) &gt; 切片</p>
<p>append 向切片中追加元素</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">//主动声明</span></span><br><span class="line">	<span class="keyword">var</span> a = []<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>} <span class="comment">//不规定长度即为切片(内部其实是先生成一个数组然后切片)</span></span><br><span class="line">	fmt.Printf(<span class="string">"a:%T"</span>, a)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//从数组得到切片</span></span><br><span class="line">	<span class="keyword">var</span> b = [<span class="number">3</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">	<span class="keyword">var</span> c []<span class="type">int</span></span><br><span class="line">	c = b[<span class="number">0</span>:<span class="number">2</span>] <span class="comment">//从索引0切到1,c=b[:]从开始切到结束,c=b[:2]从开始切到索引1,c=b[1:]从索引1切到最后</span></span><br><span class="line">	fmt.Println(c)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//切片大小(当前)</span></span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(c))</span><br><span class="line"></span><br><span class="line">	<span class="comment">//容量(底层数组最大放多少)</span></span><br><span class="line">	<span class="comment">//切片初始容量为他生成时的长度</span></span><br><span class="line">	fmt.Println(<span class="built_in">cap</span>(c)) <span class="comment">//cap查看当前切片的容量</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//切片追加</span></span><br><span class="line">	<span class="keyword">var</span> d = []<span class="type">int</span>{} <span class="comment">//没有填充数据时没有内存地址</span></span><br><span class="line">	fmt.Println(d, <span class="built_in">len</span>(d), <span class="built_in">cap</span>(d)) <span class="comment">//[] 0 0</span></span><br><span class="line">	d = <span class="built_in">append</span>(d, <span class="number">1</span>)               <span class="comment">//append(d, 1, 2)代表添加两个</span></span><br><span class="line">	fmt.Println(d, <span class="built_in">len</span>(d), <span class="built_in">cap</span>(d)) <span class="comment">//[1] 1 1</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="切片COPY">切片COPY</h4>
<blockquote>
<p>切片是指向型数据,所以将a切片赋值给b后b变动会影响到a</p>
<p>如果规避此问题可以使用 COPY 函数</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a := []<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">	b := a</span><br><span class="line">	b[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">	fmt.Println(a) <span class="comment">//[100 2 3]</span></span><br><span class="line">	fmt.Println(b) <span class="comment">//[100 2 3]</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> c []<span class="type">int</span>           <span class="comment">//为空没有申请内存</span></span><br><span class="line">	c = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">3</span>, <span class="number">3</span>) <span class="comment">//使用make函数申请长度为3容量为3的内存</span></span><br><span class="line">	<span class="built_in">copy</span>(c, a)            <span class="comment">//copy a的值到c,如果c的容量小于a则会数据丢失</span></span><br><span class="line">	a[<span class="number">0</span>] = <span class="number">10</span></span><br><span class="line">	fmt.Println(a) <span class="comment">//[10 2 3]</span></span><br><span class="line">	fmt.Println(c) <span class="comment">//[100 2 3]</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="切片内容的删除">切片内容的删除</h4>
<blockquote>
<p>很遗憾,切片暂时没有某个方法可以删除某个元素</p>
<p>我们只能通过手动赋值的方式来达到目的</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a := []<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>}</span><br><span class="line">	a = <span class="built_in">append</span>(a[:<span class="number">2</span>], a[<span class="number">3</span>:]...) <span class="comment">//先切索引1之前的元素再切1之后的元素然后重新赋值给a, ...是将切片的多个内容切分, ...写在追加的参数后,多个参数多个...</span></span><br><span class="line">	fmt.Println(a)              <span class="comment">//[1 3 4]</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="难题">难题</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">//切片地址永远指切片起始的地址内存,不包含结尾</span></span><br><span class="line">	a := [<span class="number">4</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>} <span class="comment">//数组</span></span><br><span class="line">	b := a[:]               <span class="comment">//切片</span></span><br><span class="line">	b[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">	fmt.Println(a[<span class="number">0</span>]) <span class="comment">//100,因切片是指向性数据,b与a共用内存</span></span><br><span class="line"></span><br><span class="line">	c := a[<span class="number">2</span>:<span class="number">3</span>]</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(<span class="built_in">cap</span>(c)) <span class="comment">//切片如果是由数组产生,那么他的容量为 切片开始处 到 数组结束处 长度</span></span><br><span class="line"></span><br><span class="line">	d := b[:]</span><br><span class="line">	fmt.Println(d) <span class="comment">//[100 2 3 4],因指向性数据,dcb都是指向数组a</span></span><br><span class="line"></span><br><span class="line">	e := d[<span class="number">2</span>:]</span><br><span class="line">	fmt.Println(e) <span class="comment">//切片不是从头开始所以地址发生了变化</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="数组排序">数组排序</h4>
<blockquote>
<p>方便快捷的将数组排序</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a := [<span class="number">5</span>]<span class="type">int</span>{<span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>}</span><br><span class="line">	sort.Ints(a[:]) <span class="comment">//sort.Ints方法将切片排序</span></span><br><span class="line">	fmt.Println(a)  <span class="comment">//因切片数据指向数组所以实际上排序了数组</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="map">map</h2>
<blockquote>
<p>引用类型</p>
<p>maps是无序的 有k有v 的数据类型</p>
<p>map必须经过初始化才可以正常使用</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="keyword">var</span> a <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span> <span class="comment">//声明map,k为string类型,v为int,不赋值为nil</span></span><br><span class="line">	fmt.Println(a)       <span class="comment">//map[]</span></span><br><span class="line">	<span class="comment">//初始化(初始化后部位nil但是还是空)</span></span><br><span class="line">	a = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>, <span class="number">8</span>) <span class="comment">//map可不指定容量但是推荐指定</span></span><br><span class="line">	fmt.Println(a)              <span class="comment">//map[]</span></span><br><span class="line">	<span class="comment">//添加键值对</span></span><br><span class="line">	a[<span class="string">"one"</span>] = <span class="number">1</span></span><br><span class="line">	a[<span class="string">"two"</span>] = <span class="number">2</span></span><br><span class="line">	fmt.Println(a) <span class="comment">//map[one:1 two:2]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//声明+初始化</span></span><br><span class="line">	b := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>{</span><br><span class="line">		<span class="string">"one"</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="string">"two"</span>: <span class="number">2</span>,</span><br><span class="line">	}</span><br><span class="line">	fmt.Println(b) <span class="comment">//map[one:1 two:2]</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="map常用方法">map常用方法</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">// 判断某个键存不存在</span></span><br><span class="line">	a := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>{</span><br><span class="line">		<span class="number">1</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="number">3</span>: <span class="number">3</span>,</span><br><span class="line">		<span class="number">2</span>: <span class="number">2</span>,</span><br><span class="line">	}</span><br><span class="line">	v, ok := a[<span class="number">1</span>]      <span class="comment">//返回两个值, 值1为这个键的值, 2为这个键存不存在</span></span><br><span class="line">	fmt.Println(v, ok) <span class="comment">//1 true</span></span><br><span class="line">	v1, ok1 := a[<span class="number">5</span>]</span><br><span class="line">	fmt.Println(v1, ok1) <span class="comment">//0 false 不存在值1为值类型的默认值,2为false</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//遍历map</span></span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> a {</span><br><span class="line">		fmt.Println(k, v)</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">//只遍历map的key</span></span><br><span class="line">	<span class="keyword">for</span> k := <span class="keyword">range</span> a {</span><br><span class="line">		fmt.Println(k)</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">//遍历map的v</span></span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> a {</span><br><span class="line">		fmt.Println(v)</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">//按照某个顺序遍历</span></span><br><span class="line">	<span class="comment">// 取key存放至切片</span></span><br><span class="line">	<span class="comment">// 切片排序</span></span><br><span class="line">	<span class="comment">// 按key对map排序</span></span><br><span class="line">	keys := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">3</span>)</span><br><span class="line">	<span class="keyword">for</span> k := <span class="keyword">range</span> a {</span><br><span class="line">		keys = <span class="built_in">append</span>(keys, k)</span><br><span class="line">	}</span><br><span class="line">	sort.Ints(keys)</span><br><span class="line">	<span class="keyword">for</span> _, key := <span class="keyword">range</span> keys {</span><br><span class="line">		fmt.Println(key, a[key])</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 删除键值对</span></span><br><span class="line">	<span class="built_in">delete</span>(a, <span class="number">1</span>) <span class="comment">//(map, 键)</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="切片与map混合">切片与map混合</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">//元素类型为map的切片</span></span><br><span class="line">	<span class="keyword">var</span> a = <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>, <span class="number">8</span>) <span class="comment">//只完成了切片的初始化</span></span><br><span class="line">	a[<span class="number">0</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>, <span class="number">2</span>)    <span class="comment">//初始化切片[0]的map</span></span><br><span class="line">	a[<span class="number">0</span>][<span class="string">"one"</span>] = <span class="number">1</span></span><br><span class="line">	fmt.Println(a) <span class="comment">//[map[one:1] map[] map[] map[] map[] map[] map[] map[]]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//值为切片的map</span></span><br><span class="line">	<span class="keyword">var</span> b = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>][]<span class="type">int</span>, <span class="number">8</span>) <span class="comment">// map初始化</span></span><br><span class="line">	b[<span class="number">0</span>] = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">5</span>)          <span class="comment">//切片初始化</span></span><br><span class="line">	b[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">	b[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">	fmt.Println(b) <span class="comment">//map[0:[1 2 0 0 0]]</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="函数">函数</h2>
<blockquote>
<p>函数是GO语言的重要组成部分</p>
<p>函数有 函数/匿名函数/闭包</p>
<p>函数名由 字母/数字/下划线 组成,函数名的第一个字母不能是数字, 在同一个包内函数名不能重复</p>
<p>参数由参数变量和类型组成,多个参数逗号分隔</p>
<p>返回值也由返回变量和类型组成, 也可以只写返回值类型,多个返回值由 () 包裹,逗号分隔</p>
<p>调用函数时,可以不接收函数的返回值</p>
<p>返回值如果指定了返回的变量名, 函数体内不用再 var 该变量, return也不用指定变量名</p>
<p>函数没有默认参数</p>
<p>函数可以赋值给另一个变量,此时该变量就是一个函数</p>
</blockquote>
<h4 id="函数组成">函数组成</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> 函数名<span class="params">(参数)</span></span>(返回值){</span><br><span class="line">    函数体</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>例如</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(x <span class="type">int</span>, y <span class="type">int</span>)</span></span> <span class="type">int</span> {</span><br><span class="line">	<span class="comment">// 求和</span></span><br><span class="line">	<span class="keyword">return</span> x + y</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	s := sum(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="函数接收n个参数">函数接收n个参数</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a ...<span class="type">int</span>)</span></span> <span class="type">int</span> { <span class="comment">//参数名后加...代表接收多个,但是参数类型是定死的,这样接受的参数为一个切片,此时a可不传</span></span><br><span class="line">	ret := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> a {</span><br><span class="line">		ret = ret + v</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	s := sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a <span class="type">int</span>, b ...<span class="type">int</span>)</span></span> <span class="type">int</span> { <span class="comment">//传a为int,b为多个,a必传</span></span><br><span class="line">	ret := a</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> b {</span><br><span class="line">		ret = ret + v</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	s := sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> { <span class="comment">//如果a,b都为int那么可以简写 a, b int</span></span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	s := sum(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="函数返回多个值">函数返回多个值</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calc</span><span class="params">(a, b <span class="type">int</span>)</span></span> (sum, sub <span class="type">int</span>) { <span class="comment">//多返回值</span></span><br><span class="line">	sum = a + b <span class="comment">//sum与sub已经定义</span></span><br><span class="line">	sub = a - b</span><br><span class="line">	<span class="keyword">return</span> <span class="comment">//直接return会自己寻找返回值</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a, b := calc(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(a, b)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="defer">defer</h4>
<blockquote>
<p>通常用于时间的记录/资源释放等等</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">// defer延迟执行,代码将要结束时再执行,执行顺序为先读到的后执行</span></span><br><span class="line">	fmt.Println(<span class="string">"go"</span>)</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="number">2</span>)</span><br><span class="line">	fmt.Println(<span class="string">"on"</span>)</span><br><span class="line">	<span class="comment">// go on 2 1</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="变量作用域">变量作用域</h4>
<blockquote>
<p>可以在函数中访问全局变量</p>
<p>优先在函数中找变量,找不到再找全局变量</p>
<p>在函数外无法访问函数内定义的变量</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//全局变量num</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> {</span><br><span class="line">	num := <span class="number">100</span> <span class="comment">//如定义了num则先用函数内的num</span></span><br><span class="line">	fmt.Println(num)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a()</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="将函数作为参数">将函数作为参数</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> {</span><br><span class="line">	<span class="keyword">return</span> x + y</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> {</span><br><span class="line">	<span class="keyword">return</span> x - y</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">(x, y <span class="type">int</span>, op <span class="keyword">func</span>(<span class="type">int</span>, <span class="type">int</span>)</span></span> <span class="type">int</span>) <span class="type">int</span> { <span class="comment">//第三个参数为函数func类型,接收两个参数int</span></span><br><span class="line">	<span class="keyword">return</span> op(x, y)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a1 := c(<span class="number">50</span>, <span class="number">60</span>, a)</span><br><span class="line">	b1 := c(<span class="number">50</span>, <span class="number">60</span>, b)</span><br><span class="line">	fmt.Println(a1)</span><br><span class="line">	fmt.Println(b1)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="匿名函数">匿名函数</h4>
<blockquote>
<p>匿名函数就是没有函数名的函数,多用于回调</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">//定义然后执行</span></span><br><span class="line">	a := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		fmt.Println(<span class="string">"匿名函数"</span>)</span><br><span class="line">	}</span><br><span class="line">	a()</span><br><span class="line"></span><br><span class="line">	<span class="comment">//定义直接执行(函数后加())</span></span><br><span class="line">	<span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		fmt.Println(<span class="string">"定义并执行"</span>)</span><br><span class="line">	}()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="闭包">闭包</h4>
<blockquote>
<p>闭包是一个函数与其相关的引用环境组合而成的实体</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">(name <span class="type">string</span>)</span></span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">string</span>)</span></span> <span class="type">string</span> { <span class="comment">//返回值为函数</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(end <span class="type">string</span>)</span></span> <span class="type">string</span> {</span><br><span class="line">		<span class="keyword">return</span> name + end</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	r := a(<span class="string">"name"</span>)  <span class="comment">//r为函数(闭包)函数内部引用外部变量</span></span><br><span class="line">	ret := r(<span class="string">"end"</span>) <span class="comment">//执行匿名函数</span></span><br><span class="line">	fmt.Println(ret)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="内置函数">内置函数</h4>
<ol>
<li>close  关闭channel</li>
<li>len  求长度</li>
<li>new  分配内存(值类型)</li>
<li>make  分配内存(引用类型)</li>
<li>append  追加</li>
<li>panic和recover  错误处理</li>
</ol>
<h4 id="panic-recover">panic/recover</h4>
<blockquote>
<p>错误抛出</p>
<p>recover需要搭配defer</p>
<p>panic直接终止,所以要在panic前定义recover和defer</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> {</span><br><span class="line">	fmt.Println(<span class="string">"a"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> { <span class="comment">//defer放到b函数最后执行</span></span><br><span class="line">		err := <span class="built_in">recover</span>() <span class="comment">//recover捕捉错误信息</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> {  <span class="comment">//如果err不为空</span></span><br><span class="line">			fmt.Println(<span class="string">"error"</span>)</span><br><span class="line">		}</span><br><span class="line">	}()</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">"b"</span>) <span class="comment">//panic报异常,准备结束,执行defer</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">()</span></span> {</span><br><span class="line">	fmt.Println(<span class="string">"c"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a()</span><br><span class="line">	b()</span><br><span class="line">	c()</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="指针">指针</h2>
<blockquote>
<p>&amp; 代表取地址</p>
<p>* 根据地址取值</p>
<p>不能操作指针</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	a := <span class="number">1</span></span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	b := &amp;a</span><br><span class="line">	fmt.Println(b)        <span class="comment">//0xc000010090</span></span><br><span class="line">	fmt.Printf(<span class="string">"%T\n"</span>, b) <span class="comment">//*int int类型的内存地址(不同类型不能相互转换)</span></span><br><span class="line">	fmt.Println(*b)       <span class="comment">//1 知道内存地址来取存储的值</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="指针与地址">指针与地址</h4>
<blockquote>
<p>地址: 内存地址</p>
<p>指针: 带类型的</p>
</blockquote>
<p>通常的使用方法</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funA</span><span class="params">(a *[3]<span class="type">int</span>)</span></span> { <span class="comment">//*代表接收数组的指针</span></span><br><span class="line">	a[<span class="number">0</span>] = <span class="number">100</span> <span class="comment">//按指针修改数据 (*a)[0] = 100</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	l1 := [<span class="number">3</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">	funA(&amp;l1)</span><br><span class="line">	fmt.Println(l1) <span class="comment">// [100 2 3]成功在内部修改了外部变量</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="建立指针">建立指针</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="keyword">var</span> a = <span class="built_in">new</span>(<span class="type">int</span>) <span class="comment">//new一个int类型指针</span></span><br><span class="line">	fmt.Println(a)   <span class="comment">//0xc000064058</span></span><br><span class="line">	*a = <span class="number">10</span></span><br><span class="line">	fmt.Println(a)  <span class="comment">//0xc000064058</span></span><br><span class="line">	fmt.Println(*a) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> c = <span class="built_in">new</span>([<span class="number">3</span>]<span class="type">int</span>) <span class="comment">//new一个切片</span></span><br><span class="line">	fmt.Println(c)      <span class="comment">//&amp;[0 0 0]</span></span><br><span class="line">	(*c)[<span class="number">0</span>] = <span class="number">1</span>         <span class="comment">//等同于 c[0] = 1</span></span><br><span class="line">	fmt.Println(*c)     <span class="comment">//[1 0 0]</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="结构体-struct-和方法">结构体(struct)和方法</h2>
<h4 id="创建自定义类型和给类型起别名">创建自定义类型和给类型起别名</h4>
<blockquote>
<p>有可能增加代码可读性</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//NewInt 创建一个新的类型 NewInt 实际上是int类型</span></span><br><span class="line"><span class="keyword">type</span> NewInt <span class="type">int</span> <span class="comment">// 定义变量时首字母大写代表该变量是公共的,别人导入这个包时也可使用变量,注释要按照格式 变量名 注释</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> int1 = <span class="type">int</span> <span class="comment">//创建类型别名</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="keyword">var</span> a NewInt</span><br><span class="line">	fmt.Println(a)        <span class="comment">//0 基于int所以默认值0</span></span><br><span class="line">	fmt.Printf(<span class="string">"%T\n"</span>, a) <span class="comment">//main.NewInt 自定义类型</span></span><br><span class="line">	<span class="keyword">var</span> b int1</span><br><span class="line">	fmt.Println(b)        <span class="comment">//0</span></span><br><span class="line">	fmt.Printf(<span class="string">"%T\n"</span>, b) <span class="comment">//int 起别名所以还是int</span></span><br><span class="line">	<span class="keyword">var</span> c <span class="type">int</span></span><br><span class="line">	fmt.Printf(<span class="string">"%T\n"</span>, c) <span class="comment">//起别名的情况下原名字也是可用的</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="结构体">结构体</h4>
<blockquote>
<p>Go语言没有面向对象的说法</p>
<p>尽管可以通过某种方式达到类似对象的效果</p>
<p>但是官方不推荐面向对象编程, Go推荐面向接口编程</p>
<p>结构体是值类型,将实例化1赋值实例化2,两者内存地址是不一样的</p>
</blockquote>
<h4 id="基本实例化">基本实例化</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="comment">// 使用type建立一个学生类型</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> {</span><br><span class="line">	name  <span class="type">string</span></span><br><span class="line">	age   <span class="type">int</span></span><br><span class="line">	sex   <span class="type">string</span></span><br><span class="line">	hobby []<span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">//实例化方法1</span></span><br><span class="line">	<span class="keyword">var</span> s1 = student{}                  <span class="comment">//如果只实例化不赋值则默认为该数据类型初始值</span></span><br><span class="line">	fmt.Printf(<span class="string">"s1_name:%v\n"</span>, s1.name) <span class="comment">//string默认为空</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//实例化方法2</span></span><br><span class="line">	<span class="keyword">var</span> s2 = <span class="built_in">new</span>(student)</span><br><span class="line">	fmt.Println(s2)      <span class="comment">// &amp;{ 0  []} ,new出来的是指针</span></span><br><span class="line">	s2.name = <span class="string">"s2"</span>       <span class="comment">// 等同于 (*s2).name 取地址</span></span><br><span class="line">	fmt.Println(s2.name) <span class="comment">//s3</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//实例化方法3</span></span><br><span class="line">	<span class="keyword">var</span> s3 = &amp;student{} <span class="comment">// 等同于2</span></span><br><span class="line">	fmt.Println(s3)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="基本初始化">基本初始化</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="comment">// 使用type建立一个学生类型</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> {</span><br><span class="line">	name  <span class="type">string</span></span><br><span class="line">	age   <span class="type">int</span></span><br><span class="line">	sex   <span class="type">string</span></span><br><span class="line">	hobby []<span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">// 初始化方法1</span></span><br><span class="line">	<span class="keyword">var</span> s1 = student{ <span class="comment">//少传则默认值替代</span></span><br><span class="line">		name:  <span class="string">"s1"</span>,</span><br><span class="line">		age:   <span class="number">18</span>,</span><br><span class="line">		sex:   <span class="string">"男"</span>,</span><br><span class="line">		hobby: []<span class="type">string</span>{<span class="string">"A"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>},</span><br><span class="line">	}</span><br><span class="line">	fmt.Println(s1)</span><br><span class="line">	fmt.Println(s1.name) <span class="comment">//结构体可以通过 . 的形式拿出来属性</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化方法2</span></span><br><span class="line">	<span class="keyword">var</span> s2 = student{ <span class="comment">//顺序与定义结构体时相同,必须全部传齐</span></span><br><span class="line">		<span class="string">"s2"</span>,</span><br><span class="line">		<span class="number">18</span>,</span><br><span class="line">		<span class="string">"男"</span>,</span><br><span class="line">		[]<span class="type">string</span>{<span class="string">"A"</span>},</span><br><span class="line">	}</span><br><span class="line">	fmt.Println(s2.name)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化方法3</span></span><br><span class="line">	<span class="keyword">var</span> s3 = &amp;student{ <span class="comment">//顺序与定义结构体时相同,必须全部传齐</span></span><br><span class="line">		<span class="string">"s3"</span>,</span><br><span class="line">		<span class="number">18</span>,</span><br><span class="line">		<span class="string">"男"</span>,</span><br><span class="line">		[]<span class="type">string</span>{<span class="string">"A"</span>},</span><br><span class="line">	}</span><br><span class="line">	fmt.Println(s3.name)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="结构体内存">结构体内存</h4>
<blockquote>
<p>结构体的每个值是排在一起的</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体内存布局</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="keyword">type</span> test <span class="keyword">struct</span> {</span><br><span class="line">		a <span class="type">int8</span></span><br><span class="line">		b <span class="type">int8</span></span><br><span class="line">		c <span class="type">int8</span></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> t = test{</span><br><span class="line">		a: <span class="number">1</span>,</span><br><span class="line">		b: <span class="number">2</span>,</span><br><span class="line">		c: <span class="number">3</span>,</span><br><span class="line">	}</span><br><span class="line">	fmt.Println(&amp;(t.a)) <span class="comment">//0xc000064058</span></span><br><span class="line">	fmt.Println(&amp;(t.b)) <span class="comment">//0xc000064059</span></span><br><span class="line">	fmt.Println(&amp;(t.c)) <span class="comment">//0xc00006405a</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="结构体嵌套">结构体嵌套</h4>
<blockquote>
<p>结构体可以相互嵌套</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 结构体的嵌套</span></span><br><span class="line"><span class="keyword">type</span> address <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;province <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;city <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;addr address <span class="comment">// 嵌套结构体 address</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;s1 := student{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: <span class="string">"s1"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;age: <span class="number">22</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr: address{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;province: <span class="string">"p"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;city: <span class="string">"c"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(s1) <span class="comment">// {s1 22 {p c}}</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(s1.addr.city) <span class="comment">// c</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="赋值给指针">赋值给指针</h4>
<blockquote>
<p>将实例化1的指针赋值给实例化2,此时实例化2是指向类型</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 结构体内存布局</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">type</span> test <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a <span class="type">int8</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b <span class="type">int8</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c <span class="type">int8</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> t = test{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a: <span class="number">1</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b: <span class="number">2</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c: <span class="number">3</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&amp;(t.a)) <span class="comment">//0xc000064058</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&amp;(t.b)) <span class="comment">//0xc000064059</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&amp;(t.c)) <span class="comment">//0xc00006405a</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;t2 := &amp;t <span class="comment">//将t的地址给t2</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(<span class="string">"%T\n"</span>, t2) <span class="comment">//*main.test</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;t2.a = <span class="number">5</span> <span class="comment">//(*stu3).a,找到内存地址</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(t.a, t2.a) <span class="comment">//5 5 两个都修改了</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="构造函数">构造函数</h4>
<blockquote>
<p>go语言的结构体没有构造函数,必须我们自己实现</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;gender <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;hobby []<span class="type">string</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 构造函数(名字带new方便理解)</span></span><br><span class="line"><span class="comment">// 1版本,初始化后返回接收,如初始化内容较多返回再接受较占内存</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newStudent</span><span class="params">(name <span class="type">string</span>, age <span class="type">int</span>, gender <span class="type">string</span>, hobby []<span class="type">string</span>)</span></span> student {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> student{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: name,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;age: age,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gender: gender,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hobby: hobby,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 2版本,初始化后返回初始化的指针,外面调用直接操作指针,避免1的问题</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newStudent2</span><span class="params">(name <span class="type">string</span>, age <span class="type">int</span>, gender <span class="type">string</span>, hobby []<span class="type">string</span>)</span></span> *student {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> &amp;student{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: name,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;age: age,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gender: gender,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hobby: hobby,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;s1Hobby := []<span class="type">string</span>{<span class="string">"a"</span>, <span class="string">"b"</span>}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;s1 := newStudent(<span class="string">"s1"</span>, <span class="number">18</span>, <span class="string">"男"</span>, s1Hobby)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(s1)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="方法和接收者">方法和接收者</h2>
<blockquote>
<p>方法是作用于特定类型变量的函数, 其中特定类型的变量叫 接受者, 接受者类似对象的 self</p>
<p>函数谁都可以调用,方法指定必须特定类型变量调用</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(接受者变量 接受者类型)</span></span> 方法名(参数列表) (返回参数) {</span><br><span class="line">    函数体</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 方法</span></span><br><span class="line"><span class="keyword">type</span> people <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;gender <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 函数</span></span><br><span class="line"><span class="comment">// func deram() {</span></span><br><span class="line"><span class="comment">// &nbsp;fmt.Println("梦想")</span></span><br><span class="line"><span class="comment">// }</span></span><br><span class="line"><span class="comment">// 指定接受类型是people</span></span><br><span class="line"><span class="comment">// 通常这个型参命名为类型的首字母小写, 比如 people叫 p</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p people)</span></span> deram() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;p.gender = <span class="number">11</span> <span class="comment">// 这里改并不会变,因为p是值类型,在函数内赋值无用</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"梦想"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *people)</span></span> deram2() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;p.gender = <span class="number">11</span> <span class="comment">// 传入指针时就有用</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"梦想"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> p1 = people{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: <span class="string">"p1"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gender: <span class="number">20</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;p1.deram() <span class="comment">// .deram会自己找方法执行</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;p1.deram2() <span class="comment">// 原版为(&amp;p1.deram2), Go语言可以简写</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="什么时候使用指针接受者">什么时候使用指针接受者</h4>
<blockquote>
<p>通常使用指针接受者</p>
</blockquote>
<h4 id="方法的追加">方法的追加</h4>
<blockquote>
<p>可以给任意类型追加方法<br>
不能给别的包定义的类型添加方法</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// MyInt 无法给外包加方法但是我们可以先自定义一个类型再给自定义类型加方法</span></span><br><span class="line"><span class="keyword">type</span> MyInt <span class="type">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MyInt)</span></span> sayHi() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"Hello"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> a MyInt</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(a)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;a.sayHi()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="结构体镶嵌达到继承的效果">结构体镶嵌达到继承的效果</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">type</span> animal <span class="keyword">struct</span> { <span class="comment">// 建立一个结构体</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> dog <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;feet <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;*animal <span class="comment">//镶嵌结构体的指针</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *animal)</span></span> move() { <span class="comment">//建立一个方法传入 animal 的指针</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(a.name)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dog)</span></span> wang() { <span class="comment">// 建立一个方法传入 dog 指针</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(d.name)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> a = dog{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;feet: <span class="number">4</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;animal: &amp;animal{ <span class="comment">// 指针</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: <span class="string">"dog1"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;a.wang()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;a.move()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="获取用户输入信息">获取用户输入信息</h2>
<blockquote>
<p>类似Python的input</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// DOS交互</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 从DOS获取值</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// var变量</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Scan(&amp;name, &amp;age) <span class="comment">//传入变量指针,用户输入直接赋值, 空格或换行分割</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Scanf(<span class="string">"name:%S age:%d \n"</span>, &amp;name, &amp;age) <span class="comment">//不常用,规定必须按照Scanf内容格式输入</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Scanln(&amp;name, &amp;age) <span class="comment">// 与1差不多但是换行就结束(只能空格分隔)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(name, age)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="程序的退出">程序的退出</h2>
<p>os.Exit(0)</p>
<h2 id="匿名字段">匿名字段</h2>
<blockquote>
<p>不推荐使用<br>
在定义结构体时可以使用匿名字段<br>
匿名字段实际上就是简写, 比如字段叫 string 实际上是一个叫 string 类型为 string 的字段<br>
因此同一类型的匿名字段只能有一个</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 匿名字段</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> { <span class="comment">// 结构体</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="type">string</span> <span class="comment">// 匿名字段</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="type">int</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;s1 := student{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: <span class="string">"s1"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(s1.<span class="type">string</span>) <span class="comment">// 为空(string的默认值)</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="JSON序列化">JSON序列化</h2>
<blockquote>
<p>Go语言自带Json包,但是上面说过Go语言跨包使用变量必须首字母大写</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"encoding/json"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 序列化</span></span><br><span class="line"><span class="comment">// Student 学生</span></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID <span class="type">int</span> <span class="string">`json:"id"`</span> <span class="comment">// 如想改变json的k,语法同本行,不带空格</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Gender <span class="type">string</span> <span class="string">`json:"gender"`</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Name <span class="type">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;s1 := Student{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID: <span class="number">1</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gender: <span class="string">"男"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name: <span class="string">"s1"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 序列化</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;v, err := json.Marshal(s1) <span class="comment">// json.Marshal方法,json序列化,返回值和报错信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> { <span class="comment">// 不为nil代表报错</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(v) <span class="comment">// [123 34 73 68 34 58 49 44 34 71 101 110 ...] 每个字节</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="type">string</span>(v)) <span class="comment">// []byte转string, json</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 反序列化</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;j1 := <span class="type">string</span>(v)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;s2 := &amp;Student{} <span class="comment">//指针赋给s2</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;json.Unmarshal([]<span class="type">byte</span>(j1), s2) <span class="comment">// 接收两个参数,一是切片,二是要转换的类型指针</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(s2) <span class="comment">// &amp;{1 男 s1}, 指针</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(*s2) <span class="comment">// {1 男 s1}, 内容</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="defore深入理解">defore深入理解</h2>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// defore 难题</span></span><br><span class="line"><span class="comment">// return在汇编上本质分为 获取返回值 &gt; RET指令, 加上defore是 获取返回值 &gt; defore &gt; RET指令</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span></span> <span class="type">int</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x := <span class="number">5</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x++</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> x <span class="comment">// 返回值为int, 走到return时先看到返回值不是x而是int所以先拿到返回值5, 执行defore x++, 对返回值无影响, 返回5</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">()</span></span> (x <span class="type">int</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x++</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="number">5</span> <span class="comment">// 返回值为 x, func时x=0, return时5赋值给x,然后执行defore, x++=6, 返回6</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f3</span><span class="params">()</span></span> (y <span class="type">int</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x := <span class="number">5</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x++</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> x <span class="comment">// 返回值为y, func时y=0, y为值类型所以return时将x的值5copy给y, defore x++对y无影响, 返回5</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f4</span><span class="params">()</span></span> (x <span class="type">int</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(x <span class="type">int</span>)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x++</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}(x)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="number">5</span> <span class="comment">// 返回值为x, func时x=0, return时5赋值给x, 执行defore 将x传入, 但是Go函数是形参,所以defore函数内部新建一个x, x++对外部x无影响, 返回5</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(f1())</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(f2())</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(f3())</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(f4())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Go语言的包">Go语言的包</h2>
<blockquote>
<p>通常情况下, 代码不可能放到一个文件里,这时我们就需要封包</p>
<p>一个包(文件夹)中永远只有一个main文件,这是这个包中的总入口</p>
</blockquote>
<h4 id="定义包">定义包</h4>
<blockquote>
<p>文件的第一行</p>
<p>如果包中有一个叫 mian 的package,那这个包是可执行的文件</p>
<p>如果没有 main 代表这个包是导入的包, 不能自己执行</p>
<p>一个文件夹下只有一个包, 一个包不能拆分成两个文件夹</p>
<p>包名可以不与文件夹名字重叠, 包名不能有 - 符号</p>
<p>包名为 main  是这个程序的入口包, 编译时去除main包就得不到可执行文件</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> 包名</span><br></pre></td></tr></tbody></table></figure>
<h4 id="可见性">可见性</h4>
<blockquote>
<p>一个包如果想让外部调用他的标识符(变量/常量/类型/函数…),该标识符必须是对外可见的(首字母大写)</p>
</blockquote>
<h4 id="导入包">导入包</h4>
<blockquote>
<p>自己写的本地包导入路径是 GOPATH/src/路径</p>
<p>使用时是按照包名而不是文件夹名</p>
<p>导入包可以给这个包起别名,然后使用别名即可</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> 别名 包</span><br></pre></td></tr></tbody></table></figure>
<h4 id="匿名导入包">匿名导入包</h4>
<blockquote>
<p>只导入包而不适用包内数据</p>
<p>匿名导入的包编译时也会加入</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ 包</span><br></pre></td></tr></tbody></table></figure>
<h2 id="初始化函数">初始化函数</h2>
<blockquote>
<p>包在被导入时会触发包内部的 init() 函数,该函数没有参数也没有返回值</p>
<p>init() 不能在代码中主动调用, 只能在程序运行时自动调用</p>
<p>多用来做初始化操作</p>
<p>顺序: 全局声明 &gt; init &gt; main</p>
</blockquote>
<h2 id="time包">time包</h2>
<blockquote>
<p>Go语言中预设的处理时间的包</p>
</blockquote>
<h4 id="时间戳">时间戳</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myTimeStamp</span><span class="params">(timestamp <span class="type">int64</span>)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;timeObj := time.Unix(timestamp, <span class="number">0</span>) <span class="comment">// 时间戳转时间格式, 0是纳秒的偏移量,通常为0(不偏移)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(timeObj)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;now := time.Now() <span class="comment">// 当前时间,实例化一个time.Now结构体</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(<span class="string">"%#v"</span>, now) <span class="comment">// time.Time{wall:0xbf3f74ec230757d8, ext:5984001, loc:(*time.Location)(0x57bfc0)}</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Year()) <span class="comment">// 年 2019</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Month()) <span class="comment">// 月 July</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Day()) <span class="comment">// 日 4</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Hour()) <span class="comment">// 时 9</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Minute()) <span class="comment">// 分 56</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Second()) <span class="comment">// 秒 39</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Nanosecond()) <span class="comment">// 纳秒 531441700</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 时间戳</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Unix()) <span class="comment">// 时间戳 1562205575</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.UnixNano()) <span class="comment">// 纳秒级别时间戳 1562205575360303400</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="定时器">定时器</h4>
<blockquote>
<p>按照时间重复执行</p>
<p>不在乎上一个有没有执行完毕</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 定时器</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tickDemo</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ticker := time.Tick(time.Second) <span class="comment">// 定义一个间隔1s的定时器</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="keyword">range</span> ticker {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(i)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;tickDemo()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="时间格式化">时间格式化</h4>
<blockquote>
<p>其他语言通常使用 YYYY-MM-DD… 来格式化</p>
<p>Go语言使用Go的出生时间 2006年1月2日15点04分 来格式化</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">format</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;now := time.Now()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 格式化时间模板为Go的出生日期 2006年1月2日15点04分</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Format(<span class="string">"2006-01-02 15:04:05"</span>)) <span class="comment">// 2019-07-04 15:54:22</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Format(<span class="string">"2006/01/02 15:04:05"</span>)) <span class="comment">// 2019/07/04 15:54:22</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Format(<span class="string">"2006-01-02"</span>)) <span class="comment">// 2019-07-04</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(now.Format(<span class="string">"15:04"</span>)) <span class="comment">// 15:54</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;format()</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="接口">接口</h2>
<blockquote>
<p>此接口不是web接口</p>
<p>此接口指一种类型(interface)</p>
<p>是抽象的类型</p>
<p>接口是一组 method 的组合, 是一个协议, 一种规范</p>
<p>Go语言提倡面向接口编程</p>
<p>接口名一般是单词+er</p>
<p>方法名首字母大写且接口名大写的情况下该接口可以被外部导入<br>
如果接口接受的是指针, 那么传入值类型会出错</p>
<p>如果接口接受值类型, 那么如果传入指针类型Go语言会自己找到对应的值传入</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> 接口类型名 <span class="keyword">interface</span>{</span><br><span class="line">    方法名<span class="number">1</span>(参数列表<span class="number">1</span>) 返回值列表<span class="number">1</span></span><br><span class="line">    方法名<span class="number">2</span>(参数列表<span class="number">2</span>) 返回值列表<span class="number">2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="为什么使用接口">为什么使用接口</h4>
<blockquote>
<p>将所有拥有共同点的类型统一处理,避免代码雍余</p>
<p>比如微信支付/支付宝支付/银联支付… 都是支付, 我们可以统称为 支付方式</p>
</blockquote>
<h4 id="接口实现">接口实现</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 接口实现</span></span><br><span class="line"><span class="comment">// 就这里来说, 只要一个类型实现了wash 和 dry 方法,我们就叫这个类型实现了 xiyiji 这个接口</span></span><br><span class="line"><span class="keyword">type</span> xiyiji <span class="keyword">interface</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;wash() <span class="comment">// 洗衣</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dry() <span class="comment">// 甩干</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> haier <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;price <span class="type">float64</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h haier)</span></span> wash() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"haier wash"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h haier)</span></span> dry() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"haier price"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> people <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p people)</span></span> wash() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"people wash"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p people)</span></span> dry() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"people price"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p people)</span></span> dry1() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"people price1"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// haier 和 people 都有dry和wash方法, 接口赋值后可以像调用方法一样使用, 所以接口是抽象的,不关心赋值的结构体类型, 只要你有我规定的方法即可(可以比我规定的方法多)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> a xiyiji</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;h1 := haier{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: <span class="string">"小神童"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price: <span class="number">188.8</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;a = h1 <span class="comment">// 接口是抽象类型,所以可以被赋值结构体, 前提是结构体必须有接口规定的方法</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(a)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;a.dry() <span class="comment">// haier price 调用haier的dry</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;p1 := people{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: <span class="string">"p1"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;a = p1</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;p1.dry() <span class="comment">// people price 调用people的dry</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 为什么使用接口,狗和猫都能叫, 我们为什么不能将其合在一起</span></span><br><span class="line"><span class="comment">// Cat 猫结构体</span></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span>{}</span><br><span class="line"><span class="comment">// Dog 狗结构体</span></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span>{}</span><br><span class="line"><span class="comment">// Sayer 结构体</span></span><br><span class="line"><span class="keyword">type</span> Sayer <span class="keyword">interface</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Say() <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// Say 猫叫</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> Say() <span class="type">string</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="string">"喵喵喵"</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// Say 狗叫</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Dog)</span></span> Say() <span class="type">string</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="string">"汪汪汪"</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// c := Cat{}</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// d := Dog{}</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// fmt.Println(c.Say())</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// fmt.Println(d.Say())</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 接口形式</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> animalList []Sayer</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c := Cat{}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;d := Dog{}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;animalList = <span class="built_in">append</span>(animalList, c, d)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> _, i := <span class="keyword">range</span> animalList {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(i.Say())</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="类型与接口的关系">类型与接口的关系</h4>
<blockquote>
<p>一个类型可以实现多个接口</p>
<p>一个接口可对接多种类型</p>
</blockquote>
<h4 id="接口的嵌套">接口的嵌套</h4>
<blockquote>
<p>接口可以嵌套</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 接口1</span></span><br><span class="line"><span class="keyword">type</span> speaker <span class="keyword">interface</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;speak()</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 接口2</span></span><br><span class="line"><span class="keyword">type</span> mover <span class="keyword">interface</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;move()</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 接口嵌套</span></span><br><span class="line"><span class="keyword">type</span> animal <span class="keyword">interface</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;speaker <span class="comment">// 嵌套接口1</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;mover <span class="comment">// 接口2</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 结构体</span></span><br><span class="line"><span class="keyword">type</span> cat <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c cat)</span></span> speak() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"speak"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c cat)</span></span> move() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"move"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> x animal</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x = cat{name: <span class="string">"cat1"</span>}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x.move() <span class="comment">// 直接.方法 即可</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x.speak()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="空接口">空接口</h4>
<blockquote>
<p>没有定义任何方法的接口</p>
<p>任何类型都满足规则,可以存储任何类型的变量</p>
<p>如果我们想定义一个函数, 参数为任意值则需要定义传参为空接口</p>
<p>定义一个map值为空接口则map值为任意类型</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 空接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">showType</span><span class="params">(a <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(<span class="string">"%T\n"</span>, a)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;showType(<span class="number">1</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;showType(<span class="string">"wwwaw"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;showType(<span class="number">1.256</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 值为空接口的map</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> stuInfo = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>{}, <span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;stuInfo[<span class="string">"A"</span>] = <span class="number">100</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;stuInfo[<span class="string">"B"</span>] = <span class="literal">true</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;stuInfo[<span class="string">"C"</span>] = <span class="string">"ahdha"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(stuInfo)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="类型断言">类型断言</h2>
<blockquote>
<p>判断某个变量是否是某个类型</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">值, 判断是否类型对应 := 变量.(类型)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 类型断言</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> x <span class="keyword">interface</span>{}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x = <span class="number">100</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;v, ok := x.(<span class="type">int</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(v, ok) <span class="comment">// 100 true</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>类型断言简单版(常用)</p>
<p>v不需要可以使用占位符</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 类型断言</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> x <span class="keyword">interface</span>{}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x = <span class="number">100</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">switch</span> v := x.(<span class="keyword">type</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"string"</span>, v)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"int"</span>, v)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="接口值">接口值</h2>
<blockquote>
<p>一个接口的值由一个 具体类型 和 具体值 组成</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> x <span class="keyword">interface</span>{}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> a <span class="type">int64</span> = <span class="number">100</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> b <span class="type">int32</span> = <span class="number">10</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> c <span class="type">int8</span> = <span class="number">1</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x = a <span class="comment">// 此时x为 &lt;int64, 100&gt;</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x = b <span class="comment">// &lt;int32, 10&gt;</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x = c <span class="comment">// &lt;int8, 10&gt;</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;x = <span class="literal">false</span> <span class="comment">// &lt;bool, false&gt;</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(x)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Go对文件进行操作">Go对文件进行操作</h2>
<blockquote>
<p>文本分为文本文件和二进制文件</p>
</blockquote>
<h4 id="打开文件">打开文件</h4>
<blockquote>
<p>os.Open(文件路径)</p>
<p>返回两个参数, 参数1(file)为获取的文件, 参数2为错误信息</p>
</blockquote>
<h4 id="关闭文件">关闭文件</h4>
<blockquote>
<p>先打开文件获得参数1(file), 然后参数1.Close()即可</p>
<p>通常将关闭文件写在 defore 里</p>
</blockquote>
<h4 id="读取文件">读取文件</h4>
<blockquote>
<p>file.Read()</p>
</blockquote>
<h4 id="初始版">初始版</h4>
<blockquote>
<p>循环读取128字节</p>
<p>会出现问题, 例如中文128字节可能截断分隔汉字, 导致乱码</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"io"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 文件操作</span></span><br><span class="line"><span class="comment">// 打开关闭文件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">open</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;file, err := os.Open(<span class="string">"./a.txt"</span>) <span class="comment">// 打开文件, 参数1为文件, 2为报错信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> { <span class="comment">// 不为nil代表出现错误</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(<span class="string">"文件打开失败,错误:%v"</span>, err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 文件可以打开</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> file.Close() <span class="comment">// defer延迟关闭文件</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 读文件</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> tmp [<span class="number">128</span>]<span class="type">byte</span> <span class="comment">// 定义一个128长度的字节数组</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> { <span class="comment">// 每次读取128字节</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n, err := file.Read(tmp[:]) <span class="comment">// 将文件内容赋值给tmp, 返回两个返回值, n为本次读取长度, err代表读取错误</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err == io.EOF {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 文件读取完毕会报出一个 EOF 错误, 并且n为0</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"文件读取完毕"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 文件读取失败</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"err:"</span>, err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(n) <span class="comment">// 本次长度</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Print(<span class="type">string</span>(tmp[:])) <span class="comment">// 文本内容就在切片里</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;open()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="bufio读取文件">bufio读取文件</h4>
<blockquote>
<p>上方的代码是直接从硬盘中读取数据</p>
<p>bufio封装一层, 等同于在代码和系统之间加一个缓冲区</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"bufio"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"io"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// bufio</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;file, err := os.Open(<span class="string">"./a.txt"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> file.Close()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 读取文件</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;reader := bufio.NewReader(file)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> { <span class="comment">// 会自己循环</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str, err := reader.ReadString(<span class="string">'\n'</span>) <span class="comment">// 读取到指定字符结束</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err == io.EOF {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Print(str)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Print(str)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="ioutil读取文件">ioutil读取文件</h4>
<blockquote>
<p>更高级, 会自己捕捉EOF及err异常</p>
<p>也会自己控制打开和关闭文件</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"io/ioutil"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readFile</span><span class="params">(f <span class="type">string</span>)</span></span> { <span class="comment">// 传入filename</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;content, err := ioutil.ReadFile(f)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="type">string</span>(content))</span><br><span class="line">}</span><br><span class="line"><span class="comment">// ioutil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;readFile(<span class="string">"./a.txt"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="OpenFile操作文件">OpenFile操作文件</h4>
<blockquote>
<p>Open函数功能较浅显, 当我们需要实现文件的写入时, 就需要使用 OpenFile 函数</p>
<p>OpenFile函数能以指定模式打开文件, 模式有多种</p>
</blockquote>
<p>OpenFile源代码如下</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">OpenFile</span><span class="params">(name <span class="type">string</span>, flag <span class="type">int</span>, perm FileMode)</span></span> (*File, <span class="type">error</span>){</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>其中, name是打开的文件, flag为打开文件的模式<br>
<img src="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172216369-649555803.png" alt=""></p>
<p>prm为文件权限, 八进制数, r(读)04, w(写)02, x(执行)01</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"os"</span></span><br><span class="line"><span class="comment">// 文件写</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;file, err := os.OpenFile(<span class="string">"x.txt"</span>, os.O_CREATE|os.O_WRONLY, <span class="number">0755</span>) <span class="comment">// 打开文件,没有则新建</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> file.Close()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;str := <span class="string">"架飞机啊"</span> <span class="comment">// 写入</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;file.WriteString(str)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="bufio-NewWriter写入文件">bufio.NewWriter写入文件</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">        file, err := os.OpenFile(<span class="string">"xx.txt"</span>, os.O_CREATE|os.O_TRUNC|os.O_WRONLY, <span class="number">0666</span>)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">                fmt.Println(<span class="string">"open file failed, err:"</span>, err)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">defer</span> file.Close()</span><br><span class="line">        writer := bufio.NewWriter(file)</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">                writer.WriteString(<span class="string">"hello沙河\n"</span>) <span class="comment">//将数据先写入缓存</span></span><br><span class="line">        }</span><br><span class="line">        writer.Flush() <span class="comment">//将缓存中的内容写入文件}</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="ioutil-WriteFile写入文件">ioutil.WriteFile写入文件</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"io/ioutil"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 文件写</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;str := <span class="string">"hello 沙河"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := ioutil.WriteFile(<span class="string">"./xx.txt"</span>, []<span class="type">byte</span>(str), <span class="number">0666</span>) <span class="comment">// 只支持切片</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"write file failed, err:"</span>, err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="反射">反射</h2>
<blockquote>
<p>通用工具类型太多, 类型断言猜不全, 使用反射拿到接口值的动态类型和动态值</p>
<p>反射平常不常用</p>
<p>各种框架源码比较常用</p>
<p>反射使代码更灵活,但是执行效率较低</p>
<p>反射代码难懂, 容易panic, 性能很低</p>
</blockquote>
<h2 id="reflect包">reflect包</h2>
<h4 id="TypeOf">TypeOf</h4>
<blockquote>
<p>reflect.TypeOf() 函数可以获得任意值的类型对象</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// reflect</span></span><br><span class="line"><span class="keyword">type</span> cat <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myTypeOf</span><span class="params">(i <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;v := reflect.TypeOf(i) <span class="comment">// 获取变量i的类型</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(v, v.Name(), v.Kind()) <span class="comment">// v.Name()输出这个i的类型名, v.Kind()输出这个i的大的种类,比如所有结构体都是结构体,引用类型的Name为空</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;myTypeOf(<span class="string">"jagjgag"</span>) <span class="comment">// string string string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;a := <span class="literal">false</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;myTypeOf(a) <span class="comment">// bool bool bool</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> c1 = cat{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: <span class="string">"花花"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;myTypeOf(c1) <span class="comment">// main.cat cat struct (可以查找出出自定义的结构体等)</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="ValueOf">ValueOf</h4>
<blockquote>
<p>获取动态值</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 值进入该函数变成空接口,ValueOf获取这个参数原有的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectValue</span><span class="params">(x <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;v := reflect.ValueOf(x) <span class="comment">// 获取接口值信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;k := v.Kind() <span class="comment">// kind获取值对应类型</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">switch</span> k { <span class="comment">// 对比判断</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">case</span> reflect.Int64:</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(<span class="string">"Int64 %d\n"</span>, <span class="type">int64</span>(v.Int()))</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">case</span> reflect.Float32:</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(<span class="string">"float32 %f\n"</span>, <span class="type">float32</span>(v.Float()))</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> a <span class="type">float32</span> = <span class="number">3.14</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> b <span class="type">int64</span> = <span class="number">200</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;reflectValue(a)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;reflectValue(b)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="通过反射修改外部变量值">通过反射修改外部变量值</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 通过反射修改值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">editValue</span><span class="params">(x <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 想要在函数内修改函数外的值必须通过修改指针对应值的形式</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;v := reflect.ValueOf(x) <span class="comment">// 获取传入的值</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;kind := v.Kind() <span class="comment">// 获取值的类型</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">switch</span> kind {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">case</span> reflect.Ptr: <span class="comment">// 判断为指针,修改</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.Elem().SetInt(<span class="number">500</span>) <span class="comment">// v.Elem()才是传入值的指针, SetInt()为修改值为Int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> a <span class="type">int64</span> = <span class="number">100</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;editValue(&amp;a)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(a)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Tag">Tag</h4>
<blockquote>
<p>Tag是结构体中某个字段别名, 可以定义多个, 空格分隔, 其中名为json的tag是序列化反序列化的名字</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Name <span class="type">string</span> <span class="string">`json:"name" a:"b"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="结构体反射查看字段">结构体反射查看字段</h4>
<blockquote>
<p>用的较多</p>
<p>任意值通过 reflect.TypeOf() 获得反射对象的信息后,如果它的类型为结构体, 可以通过反射值对象 的 NumField() 和 Field() 方法获得结构体成员的详细信息</p>
</blockquote>
<p><img src="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172314114-1899805474.png" alt=""></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 结构体反射</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Name <span class="type">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;s1 := student{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name: <span class="string">"s1"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;t := reflect.TypeOf(s1)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(t.Name(), t.Kind()) <span class="comment">// student struct</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 循环遍历结构体s1, NumField() 为结构体长度</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field := t.Field(i) <span class="comment">// 拿出某个字段i</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(field.Name, field.Index, field.Type, field.Tag.Get(<span class="string">"json"</span>)) <span class="comment">// 字段名, 索引, 类型, jsonTag</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 通过字段名</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;scoreField, ok := t.FieldByName(<span class="string">"Name"</span>) <span class="comment">// 查找名为Name的字段, ok为True代表有字段, 此时scoreField为该字段</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> ok {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(scoreField.Name, scoreField.Index, scoreField.Type, scoreField.Tag.Get(<span class="string">"json"</span>)) <span class="comment">// Name [0] string name</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="结构体反射查看方法">结构体反射查看方法</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 查看结构体的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printMethod</span><span class="params">(x <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;t := reflect.TypeOf(x)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;v := reflect.ValueOf(x)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; v.NumMethod(); i++ { <span class="comment">// 遍历方法</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;methodType := v.Method(i).Type() <span class="comment">// 拿到方法</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(t.Method(i).Name) <span class="comment">// 方法名</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(methodType) <span class="comment">// 方法</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 通过反射调用方法, 需要传值必须是 []reflect.Value{} 类型</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> args = []reflect.Value{}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.Method(i).Call(args)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="并发">并发</h2>
<blockquote>
<p>并发是Go语言的优势</p>
</blockquote>
<h4 id="并发与并行">并发与并行</h4>
<p>并发: 同一时段做多个事情<br>
并行: 同一时刻做多个事情</p>
<h4 id="进程-线程-协程">进程,线程,协程</h4>
<blockquote>
<p>go只需要 goroutine</p>
</blockquote>
<p>进程: 一个程序启动后创建一个进程<br>
线程: 操作系统调度的最小单位<br>
协程: 用户态的线程</p>
<h4 id="goroutine">goroutine</h4>
<blockquote>
<p>Go语言的 runtime 自动决定程序在哪里运行</p>
<p>使用 go 关键字创建 goroutine 一个函数可以创建多个 goroutine, 一个goroutine必对应一个函数</p>
<p>Go的 goroutine 启动一个占用2KB内存(线程占用2MB), 而且 goroutine可动态扩充大小(最大1GB), goroutine启1w个也没问题</p>
<p>goroutine直接通讯只能用 channel</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 启动 goroutine</span></span><br><span class="line"><span class="comment">// goroutine 通常和 sync 的 WaitGroup 结合使用</span></span><br><span class="line"><span class="comment">// WaitGroup是一个计时器</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"hello"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> wg.Done() <span class="comment">// 执行结束后告诉wg执行完毕,推荐用defer</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 函数前加 go 就是调用 goroutine 执行</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 1. 创建goroutine</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 2. 在goroutine执行hello</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;wg.Add(<span class="number">1</span>) <span class="comment">// 计时器加1, 启动一个 goroutine</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> hello()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"func hello on"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;wg.Wait() <span class="comment">// 等待wg全部执行结束(Done)才结束</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="goroutine和线程的区别">goroutine和线程的区别</h4>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/14_concurrence/">https://www.liwenzhou.com/posts/Go/14_concurrence/</a></p>
<blockquote>
<p>Go的 goroutine 启动一个占用2KB内存(线程占用2MB), 而且 goroutine可动态扩充大小(最大1GB), goroutine启10w个也没问题</p>
<p>开启线程调度是代码请求系统创建然后提供给代码操作, goroutine是由Go的运行时(runtime)自己调度, 这个调度器使用一个 m:n 调度技术(复用/调度m个goroutine到n个os线程),所以不需要切换内核语境,成本低,速度快</p>
<p>GOMAXPROCS(m:n的n) 决定Go运行时使用几个线程来执行Go程序, 默认值是机器上的CPU核心数</p>
<p>Go语言1.5版本后默认跑满核心, 可以通过 runtime.GOMAXPROCS(核心数) 来设置核心</p>
</blockquote>
<ol>
<li>一个操作系统可开启多个 goroutine</li>
<li>Go程序可以同时使用多个系统线程</li>
<li>goroutine和os线程是多对多的关系, m:n(goroutine : CPU核心)</li>
</ol>
<h2 id="channel">channel</h2>
<blockquote>
<p>管道</p>
<p>一般来说其他语言常使用多个线程使用同一个共享内存,但是要考虑到数据的安全一致性必须要加锁, 这就导致了速度和效率会下降</p>
<p>Go语言不提倡使用共享内存的方式</p>
<p>channel则是在多个 goroutine 中搭建管道互传消息</p>
<p>channel是引用类型</p>
<p>channel可以不关闭,Go的垃圾回收会自己关闭</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// channel</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// c1为chan类型的管道, 传输1个int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">1</span>) <span class="comment">// chan是引用类型所以需要make</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// channel 发送和接收 &lt;-</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c1 &lt;- <span class="number">10</span> <span class="comment">// 把10发送到c1</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ret := &lt;-c1 <span class="comment">// 接收c1(不写ret则是丢弃值)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(ret)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="built_in">close</span>(c1) <span class="comment">// 关闭管道, 关闭的通道再接受值不报错,如果管道有值,则依次取出,无值 取到对应值的零值, 不可发送值, 不可重复关闭一个通道</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="无缓冲通道和缓冲通道">无缓冲通道和缓冲通道</h4>
<blockquote>
<p>在创建 channel 时, make需要带上长度, 这个长度实际上是一个缓冲区, 可以理解为管道长度, 如果为10代表当数据没有接收时, 数据存储在管道里可以存储10个</p>
<p>不写长度代表无缓冲, 此时通过管道传输数据时必须同时有人在接收否则会报 死锁 错误</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// channel</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">recv</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">bool</span>)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&lt;-ch</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>) <span class="comment">// 创建无缓冲通道(不规定长度)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> recv(c1)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c1 &lt;- <span class="literal">false</span> <span class="comment">// 不会报错因为recv函数中已经在等待接收c1的值</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="built_in">len</span>(c1), <span class="built_in">cap</span>(c1)) <span class="comment">// len()获取当前管道的值长度, cap()获取管道容量</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="判断通道是否关闭">判断通道是否关闭</h4>
<blockquote>
<p>由于通道关闭后也能取出0值,所以我们要先判断通道是否已关闭</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">// 判断通道是否关闭</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">int</span>)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch &lt;- i</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> <span class="built_in">close</span>(ch)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> ch1 = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> send(ch1)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 方法1</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret, ok := &lt;-ch1 <span class="comment">// 如通道关闭ok为false</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> !ok {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">break</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(ret)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 方法2</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> ret := <span class="keyword">range</span> ch1 { <span class="comment">// range自己判断</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(ret)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="select多路复用">select多路复用</h4>
<blockquote>
<p>某些情况下我们需要指定多个通道,其中一个通道有值就继续走下去<br>
Go内置了 select 方法来帮助我们实现</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// select多路复用</span></span><br><span class="line"><span class="keyword">var</span> ch1 = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">var</span> ch2 = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">100</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">string</span>)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch1 &lt;- fmt.Sprintf(<span class="string">"f1:%d"</span>, i)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">string</span>)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch2 &lt;- fmt.Sprintf(<span class="string">"f2:%d"</span>, i)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> f1(ch1)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> f2(ch2)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">select</span> { <span class="comment">// select多个ret通道</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">case</span> ret := &lt;-ch1:</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(ret)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">case</span> ret := &lt;-ch2:</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(ret)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">default</span>:</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"取不到值"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.Sleep(time.Millisecond * <span class="number">500</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="单向通道">单向通道</h4>
<blockquote>
<p>设置通道的 可读/可写</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="comment">// 传入的chan只能写</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">p</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> {</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 传入的chan只能读</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">p1</span><span class="params">(ch &lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span></span> {</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 传入的chan可读写</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">p2</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">int</span>)</span></span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="并发控制与锁">并发控制与锁</h2>
<blockquote>
<p>并发时,有可能遇到多个 goroutine 同时操作一个内存数据的情况, 这时候就会发生无法预料的数据紊乱, 此时我们需要给这个数据加锁, 在某个 goroutine 操作数据时其他 goroutine 等待, 这样就保证了数据的安全</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/14_concurrence/">https://www.liwenzhou.com/posts/Go/14_concurrence/</a></p>
<h4 id="互斥锁">互斥锁</h4>
<blockquote>
<p>同时只能一个 goroutine 操作一个数据</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="comment">// 互斥锁</span></span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> wg.Done()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock.Lock() <span class="comment">// 加互斥锁</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num = num + <span class="number">1</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock.Unlock() <span class="comment">// 解锁</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;wg.Add(<span class="number">5</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;wg.Wait()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(num)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="读写互斥锁">读写互斥锁</h4>
<blockquote>
<p>同一时间只能一个 goroutine 写, 但是不限制读的 goroutine</p>
<p>此锁适用于 读次数多, 写次数少 的情况下</p>
<p>如读写频率一致或写多于读则推荐使用互斥锁</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="comment">// 读写锁</span></span><br><span class="line"><span class="keyword">var</span> rwLock sync.RWMutex</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> wg.Done()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">0</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwLock.RLock() <span class="comment">// 加读锁</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(num)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwLock.RUnlock() <span class="comment">// 释放读锁</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwLock.Lock() <span class="comment">// 加写锁</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num = num + <span class="number">1</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwLock.Unlock() <span class="comment">// 释放写锁</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;wg.Add(<span class="number">5</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> add()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;wg.Wait()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(num)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="map的并发">map的并发</h4>
<blockquote>
<p>并发时map会自主报错,这是一个自己的保护机制, 防止多个 foroutine 导致kv不一致</p>
<p>Go内置了 sync.map ,并发安全/开箱即用</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/14_concurrence/#autoid-4-3-0">https://www.liwenzhou.com/posts/Go/14_concurrence/#autoid-4-3-0</a></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"strconv"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// sync.map</span></span><br><span class="line"><span class="keyword">var</span> m = sync.Map{} <span class="comment">// 自己加了互斥锁</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;wg := sync.WaitGroup{}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wg.Add(<span class="number">1</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key := strconv.Itoa(n)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.Store(key, n)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v, _ := m.Load(key)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(key, v)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wg.Done()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}(i)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;wg.Wait()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="单元测试">单元测试</h2>
<blockquote>
<p>开发人员自测</p>
<p>大的程序分为多个功能单元, 开发完一个单元后自己进行测试</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/16_test/">https://www.liwenzhou.com/posts/Go/16_test/</a></p>
<h4 id="Go语言单元测试">Go语言单元测试</h4>
<blockquote>
<p>Go 内置单元测试包 testing</p>
<p>一般我们会编写相关的函数作为测试使用</p>
<p>测试函数的命名需遵守相关约定</p>
<p>测试函数统一写在一个以 _test.go 为后缀名的文件中, 在编译时会自动忽略此类文件</p>
<p>使用 go test 命令会自己寻找当前包内的 *_test.go 文件, 然后生成一个临时的main包用于调用相应的测试函数，然后构建并运行、报告测试结果，最后清理测试中生成的临时文件。</p>
</blockquote>
<p><img src="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172407173-2015921684.png" alt=""></p>
<h4 id="基准测试">基准测试</h4>
<blockquote>
<p>测试运行时间/占用资源等等数据</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/16_test/#autoid-2-5-0">https://www.liwenzhou.com/posts/Go/16_test/#autoid-2-5-0</a></p>
<h4 id="Setup和TearDown">Setup和TearDown</h4>
<blockquote>
<p>测试开始前和结束后执行的逻辑</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/16_test/#autoid-3-5-0">https://www.liwenzhou.com/posts/Go/16_test/#autoid-3-5-0</a></p>
<h2 id="网络编程">网络编程</h2>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/15_socket/">https://www.liwenzhou.com/posts/Go/15_socket/</a></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// HTTP server</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">res</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> { <span class="comment">// 接受参数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(r.Method) <span class="comment">// 请求方式</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.ParseForm() <span class="comment">// 解析数据</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Form.Get(<span class="string">"name"</span>) <span class="comment">// 获取form表单中key为name的数据</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;http.HandleFunc(<span class="string">"/"</span>, res) <span class="comment">// 访问根路径走res函数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := http.ListenAndServe(<span class="string">":9090"</span>, <span class="literal">nil</span>) <span class="comment">// 监听本地端口</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> { <span class="comment">// 错误捕捉</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="MySql">MySql</h2>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/go_mysql/">https://www.liwenzhou.com/posts/Go/go_mysql/</a></p>
<h4 id="驱动下载">驱动下载</h4>
<p><code> go get -u github.com/go-sql-driver/mysql</code></p>
<h4 id="普通连接">普通连接</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"database/sql"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 注册mysql信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;db, err := sql.Open(<span class="string">"mysql"</span>, dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 这里的错误只是参数格式错误</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"db err"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 尝试连接数据库</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = db.Ping()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(<span class="string">"db filed"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="连接池连接">连接池连接</h4>
<blockquote>
<p>创建数据库句柄一般比较耗时, 所以我们使用连接池</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"database/sql"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版)</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sql.DB</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sql.Open(<span class="string">"mysql"</span>, dsn)  <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = DB.Ping()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">    <span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">    <span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="占位符">占位符</h4>
<blockquote>
<p>为防止SQL注入, 我们通常将用户信息等前端传来的可变数据通过占位符拼接, 需要注意的是, 不同数据库驱动的占位符不一样</p>
</blockquote>
<p><img src="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172446179-127845015.png" alt=""></p>
<h4 id="查询数据">查询数据</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"database/sql"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版) 增删改查</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sql.DB</span><br><span class="line"><span class="comment">// User 结构体</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;id <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sql.Open(<span class="string">"mysql"</span>, dsn)  <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = DB.Ping()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> user User</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 查询单条数据</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"SELECT id,name,age FROM `user` WHERE id=1"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = DB.QueryRow(sqlStr).Scan(&amp;user.id, &amp;user.name, &amp;user.age)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(user.id, user.name, user.age)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> user2 User</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 查询多条</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr2 := <span class="string">"SELECT id,name,age FROM `user` where id &gt; ?"</span> <span class="comment">// ?指占位符</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;rows, err := DB.Query(sqlStr2, <span class="number">0</span>) <span class="comment">// 将0替换到?</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// rows最后要close,不close会夯住</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> rows.Close()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 循环读取数据</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> rows.Next() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = rows.Scan(&amp;user2.id, &amp;user2.name, &amp;user2.age)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(user2)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="插入数据">插入数据</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"database/sql"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版) 增删改查</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sql.DB</span><br><span class="line"><span class="comment">// User 结构体</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;id <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sql.Open(<span class="string">"mysql"</span>, dsn)  <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = DB.Ping()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 插入数据</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"INSERT INTO `user`(`name`, age) VALUES(?, ?)"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name := <span class="string">"u3"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age := <span class="string">"33"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 执行</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ret, err := DB.Exec(sqlStr, name, age)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 获取到插入数据的id(不同数据库有不同实现)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID, err := ret.LastInsertId()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(ID)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="更新数据">更新数据</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"database/sql"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版) 增删改查</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sql.DB</span><br><span class="line"><span class="comment">// User 结构体</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;id <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sql.Open(<span class="string">"mysql"</span>, dsn)  <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = DB.Ping()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 更新数据</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"UPDATE `user` SET age=? WHERE id=?"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age := <span class="number">222</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID := <span class="number">2</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ret, err := DB.Exec(sqlStr, age, ID)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 返回受影响的行数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;rowLen, err := ret.RowsAffected()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(rowLen)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="删除数据">删除数据</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"database/sql"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版) 增删改查</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sql.DB</span><br><span class="line"><span class="comment">// User 结构体</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;id <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sql.Open(<span class="string">"mysql"</span>, dsn)  <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = DB.Ping()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 删除数据</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"DELETE FROM `user`WHERE id=?"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID := <span class="number">3</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ret, err := DB.Exec(sqlStr, ID)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 返回受影响的行数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;rowLen, err := ret.RowsAffected()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(rowLen)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="预处理">预处理</h4>
<blockquote>
<p>sqly预处理是只不在本地进行SQL语句的拼接, 而是将sql语句和替换的字符串分开发送至sql server ,由sql server 对sql语句和字符串拼接/替换/执行.</p>
<p>预处理在应对大量重复sql语句的情况下会提高执行效率(例如执行某个表的100次相同操作), 而且可以避免SQL注入(不代表不预处理就不做防sql注入)</p>
</blockquote>
<h6 id="预处理增删改">预处理增删改</h6>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"database/sql"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版) 增删改查</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sql.DB</span><br><span class="line"><span class="comment">// User 结构体</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;id <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sql.Open(<span class="string">"mysql"</span>, dsn)  <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = DB.Ping()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 预处理</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"INSERT INTO `user`(`name`, age) VALUES(?, ?)"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 不拼接</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;stmt, err := DB.Prepare(sqlStr)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 注册关闭</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> stmt.Close()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 执行重复的插入命令</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">4</span>; i &lt; <span class="number">20</span>; i++ {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name := fmt.Sprintf(<span class="string">"u%d"</span>, i)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt.Exec(name, i)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h6 id="预处理查询">预处理查询</h6>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"database/sql"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版) 增删改查</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sql.DB</span><br><span class="line"><span class="comment">// User 结构体</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;id <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sql.Open(<span class="string">"mysql"</span>, dsn)  <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = DB.Ping()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 预处理</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"SELECT id, name, age FROM user WHERE id=?"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 不拼接</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;stmt, err := DB.Prepare(sqlStr)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 注册关闭</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> stmt.Close()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 执行重复的插入命令</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">20</span>; i++ {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rows, err := stmt.Query(i)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">continue</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">defer</span> rows.Close()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> id <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> age <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> rows.Next() {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rows.Scan(&amp;id, &amp;name, &amp;age)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(id, name, age)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="事务">事务</h4>
<blockquote>
<p>事务开始后(Begin), 必须以 回滚(Rollback) 或 提交(Commit) 结束</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"database/sql"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版) 事务</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sql.DB</span><br><span class="line"><span class="comment">// User 结构体</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;id <span class="type">int</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;name <span class="type">string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sql.Open(<span class="string">"mysql"</span>, dsn)  <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = DB.Ping()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 开始事务</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;tx, err := DB.Begin()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 执行事务内操作</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"UPDATE user SET age=? WHERE id=?"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age := <span class="string">"30"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID := <span class="string">"3"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 执行</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_, err = tx.Exec(sqlStr, age, ID)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 出现错误回滚</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx.Rollback()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age = <span class="string">"40"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID = <span class="string">"4"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 执行</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_, err = tx.Exec(sqlStr, age, ID)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 出现错误回滚</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx.Rollback()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 走到这里证明两条语句都执行成功</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// commit提交事务</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = tx.Commit()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// commit也可能失败</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx.Rollback()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="第三方库-SQLX">第三方库 SQLX</h2>
<blockquote>
<p>第三方库 sqlx 能简化操作, 特别是查询, 能够提高开发效率</p>
</blockquote>
<h4 id="安装">安装</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u github.com/jmoiron/sqlx</span><br></pre></td></tr></tbody></table></figure>
<h4 id="基本使用">基本使用</h4>
<h6 id="查">查</h6>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/jmoiron/sqlx"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版)</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sqlx.DB</span><br><span class="line"><span class="comment">// User 结构体</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID <span class="type">int</span> <span class="string">`db:"id"`</span> <span class="comment">// db的tag为sqlx所用,标记对应的字段名</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Name <span class="type">string</span> <span class="string">`db:"name"`</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Age <span class="type">int</span> <span class="string">`db:"age"`</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sqlx.Connect(<span class="string">"mysql"</span>, dsn) <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 查询单行</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">queryDemo</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"SELECT id, name, age FROM user WHERE id=?"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> user User</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := DB.Get(&amp;user, sqlStr, <span class="number">1</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(user)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 查询多行</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">querysDemo</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"SELECT id, name, age FROM user WHERE id&gt;?"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> users []User <span class="comment">// 切片每个都是User</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := DB.Select(&amp;users, sqlStr, <span class="number">1</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> _, user := <span class="keyword">range</span> users {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(user)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// queryDemo()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;querysDemo()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h6 id="增-删-改">增/删/改</h6>
<blockquote>
<p>与使用自带 sql 无区别</p>
</blockquote>
<h6 id="事务-2">事务</h6>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/jmoiron/sqlx"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 导入下载的驱动包, 前面加_ 代表只用了init()</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接mysql(连接池版)</span></span><br><span class="line"><span class="comment">// DB 数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> DB *sqlx.DB</span><br><span class="line"><span class="comment">// User 结构体</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID <span class="type">int</span> <span class="string">`db:"id"`</span> <span class="comment">// db的tag为sqlx所用,标记对应的字段名</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Name <span class="type">string</span> <span class="string">`db:"name"`</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Age <span class="type">int</span> <span class="string">`db:"age"`</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initDB</span><span class="params">(dsn <span class="type">string</span>)</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB, err = sqlx.Connect(<span class="string">"mysql"</span>, dsn) <span class="comment">// 注意此处是将全局变量DB赋值mysql连接,所以是 = 而不是 :=</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置最大连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 最大空闲连接数(有默认)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;DB.SetMaxIdleConns(<span class="number">20</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 事务</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">transDemo</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 如果MustExec引发panic, Beginx会自己Rollback</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;tx, err := DB.Beginx()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;sqlStr := <span class="string">"UPDATE user SET age=? WHERE id=?"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age := <span class="string">"30"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID := <span class="string">"3"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;tx.MustExec(sqlStr, age, ID) <span class="comment">// 带Must方法一般指一出错直接panic</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;age = <span class="string">"40"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ID = <span class="string">"4"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;tx.MustExec(sqlStr, age, ID) <span class="comment">// 带Must方法一般指一出错直接panic</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err = tx.Commit() <span class="comment">// 提交</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx.Rollback()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// dsn := "user:password@tcp(ip:port)/databasename"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;dsn := <span class="string">"root:pwd@tcp(cdb-ecfs2q68.bj.tencentcdb.com:10075)/go_test"</span> <span class="comment">// 连接信息</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initDB(dsn)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(err)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Go使用Redis">Go使用Redis</h2>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/go_redis/">https://www.liwenzhou.com/posts/Go/go_redis/</a></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/go-redis/redis"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 连接池</span></span><br><span class="line"><span class="keyword">var</span> redisDB *redis.Client</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initClient</span><span class="params">()</span></span> (err <span class="type">error</span>) {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;redisDB = redis.NewClient(&amp;redis.Options{ <span class="comment">// 替换全局变量 redisDB</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Addr: <span class="string">"127.0.0.1:6379"</span>, <span class="comment">// HOST</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Password: <span class="string">""</span>, <span class="comment">// 密码</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DB: <span class="number">0</span>, <span class="comment">// 数据库</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;_, err = redisDB.Ping().Result() <span class="comment">// 连接</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> err</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;err := initClient()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 获取a1的值</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;ret := redisDB.Get(<span class="string">"a1"</span>).Val()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(ret)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="NSQ消息队列">NSQ消息队列</h2>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/go_nsq/">https://www.liwenzhou.com/posts/Go/go_nsq/</a></p>
<h2 id="依赖管理-old">依赖管理(old)</h2>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/go_dependency/">https://www.liwenzhou.com/posts/Go/go_dependency/</a></p>
<h4 id="安装-2">安装</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u github.com/tools/godep</span><br></pre></td></tr></tbody></table></figure>
<h4 id="保存依赖信息">保存依赖信息</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">godep save</span><br></pre></td></tr></tbody></table></figure>
<p>会在当前目录下生成两个文件夹 <code>Godeps</code> <code>vendor</code><br>
<code>Godeps</code> 存放项目依赖的包信息<br>
<code>vendor</code>  存放项目依赖包的副本</p>
<h4 id="使用">使用</h4>
<blockquote>
<p>go语言编译时会优先找当前目录下的 <code>vendor</code> 文件夹,优先使用他的模块</p>
</blockquote>
<h2 id="依赖管理-new">依赖管理(new)</h2>
<blockquote>
<p>go model 1.1后官方使用的依赖管理</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/go_dependency/#autoid-2-5-0">https://www.liwenzhou.com/posts/Go/go_dependency/#autoid-2-5-0</a></p>
<h4 id="go-mod命令">go mod命令</h4>
<p><img src="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172529101-72359284.png" alt=""></p>
<h4 id="打开mod支持">打开mod支持</h4>
<blockquote>
<p>默认情况下 go mod 是关闭的, 我们需要先打开支持</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set GO111MODULE=on</span><br></pre></td></tr></tbody></table></figure>
<h4 id="生成mod">生成mod</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> mod init 项目名  <span class="comment">// 初始化</span></span><br></pre></td></tr></tbody></table></figure>
<p>在当前目录下生成 go.mod 文件</p>
<h4 id="下载依赖">下载依赖</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> mod download</span><br></pre></td></tr></tbody></table></figure>
<p>根据 go.mod 文件下载依赖</p>
<h2 id="Gin框架">Gin框架</h2>
<p><a target="_blank" rel="noopener" href="https://gin-gonic.com/zh-cn/">https://gin-gonic.com/zh-cn/</a><br>
<a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/Gin_framework/">https://www.liwenzhou.com/posts/Go/Gin_framework/</a></p>
<h4 id="安装-更新">安装/更新</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">go</span> get -u github.com/gin-gonic/gin</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="基础版">基础版</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"net/http"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 返回 json, 状态码使用http包中的StatusOK(200)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusOK, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"msg"</span>: <span class="string">"hello"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 路由模式为 Default</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// /hello GET 返回JSON 状态码200</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.GET(<span class="string">"/hello"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(<span class="number">200</span>, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"msg"</span>: <span class="string">"hello"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// /index GET</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.GET(<span class="string">"/index"</span>, indexHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 启动</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Gin请求方式">Gin请求方式</h4>
<p>Gin支持接受所有请求方法, 包括GET/POST/PUT等等<br>
当我们不想在路由时候限制某个请求的请求方式时, 选择 Any 即可<br>
在函数内获取该请求的方式为 c.Request.Method</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 字符串形式 POST/GET/PUT ...</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(c.Request.Method)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 路由组</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Default默认使用Use 加了两个全局中间件, Logger(), Recovery(), Logger是打印日志, Recovery是panic返回500</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Any代表匹配所有请求方式</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Any(<span class="string">"/index"</span>, indexHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Gin的渲染">Gin的渲染</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 返回 json, 状态码使用http包中的StatusOK(200)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// c.JSON(http.StatusOK, gin.H{</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// &nbsp;"msg": "hello",</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// })</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 返回 HTMl(配合模板语法) 状态码, 模板文件, 模板文件传值</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// c.HTML(http.StatusOK, "web/login.html", gin.H{</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// &nbsp;"msg": "login",</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// })</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 返回结构体对象(结构体字段首字母一定大写)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// type info struct {</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// &nbsp;Info string `json:"info"`</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// }</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// i1 := info{</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// &nbsp;Info: "aaa",</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// }</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// c.JSON(http.StatusOK, i1)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 返回 XML</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// c.XML(http.StatusOK, gin.H{</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// &nbsp;"msg": "hello",</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// })</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 结构体的XML</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// type info struct {</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// &nbsp;Info string</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// }</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// i1 := info{</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// &nbsp;Info: "aaa",</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// }</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// c.XML(http.StatusOK, i1)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// yaml</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// c.YAML(http.StatusOK, gin.H{</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// &nbsp;"msg": "hello",</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// })</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 路由模式为 Default</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 加载模板文件夹(当前目录下的tpmplates文件夹下所有文件夹下所有模板文件)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.LoadHTMLGlob(<span class="string">"templates/**/*"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置静态文件目录(代码使用路径(url访问), 实际路径)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.Static(<span class="string">"static"</span>, <span class="string">"./statics"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// /index GET</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.GET(<span class="string">"/index"</span>, indexHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 启动</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Gin获取参数">Gin获取参数</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"net/http"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 获取url参数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// a := c.Query("a") // 没有参数为nil</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;a := c.DefaultQuery(<span class="string">"a"</span>, <span class="string">"av"</span>) <span class="comment">// 没有参数默认av</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 获取form参数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// f := c.PostForm("f") // 没有参数为nil</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;f := c.DefaultPostForm(<span class="string">"f"</span>, <span class="string">"fdef"</span>) <span class="comment">// 没有参数默认 fdef</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusOK, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"a"</span>: a,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"f"</span>: f,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">urlHandler</span><span class="params">(c *gin.Context)</span></span>{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 提取url参数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;u := c.Param(<span class="string">"id"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusOK, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"u"</span>: u,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 路由模式为 Default</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// /index GET</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.GET(<span class="string">"/index"</span>, indexHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 获取URL上的可变参数 id为可变参数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.GET(<span class="string">"/urlget/:id"</span>, urlHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 启动</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;router.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Gin跳转">Gin跳转</h4>
<h6 id="HTTP跳转">HTTP跳转</h6>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.Redirect(状态码, <span class="string">"地址"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="路由跳转">路由跳转</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c.Request.URL.Path = <span class="string">"跳转路由"</span></span><br><span class="line">r.HandleContext(c)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Gin路由组">Gin路由组</h4>
<blockquote>
<p>当路由较多时, 我们通常将路由分组管理(美观易维护)</p>
<p>此时我们将路由进行分组</p>
<p>可多层嵌套(层越多效率越慢)</p>
<p>在HttpRouter包封装(使用前缀树匹配比其他的使用反射速度快很多)</p>
<p>原理是创造了路由地址的前缀树(所以层越多路由匹配越慢)</p>
</blockquote>
<p><img src="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172726781-1327299399.png" alt=""></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 路由组</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 普通路由(多了不易维护)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.GET(<span class="string">"/book"</span>, bookListHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.POST(<span class="string">"/book"</span>, bookInsertHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.DELETE(<span class="string">"/book/:ID"</span>, bookDeleteHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 分组路由(易维护,可多层嵌套)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;apiV1Group := r.Group(<span class="string">"/api/v1"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apiV1Group.GET(<span class="string">"/index"</span>, v1IndexHandler) <span class="comment">// URL: /api/v1/index</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apiV1Group.GET(<span class="string">"/home"</span>, v1HomeHandler) <span class="comment">// URL: /api/v1/home</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Gin上传文件">Gin上传文件</h4>
<h6 id="单文件">单文件</h6>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"net/http"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fileHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fileObj, err := c.FormFile(<span class="string">"file"</span>) <span class="comment">// file为字段名</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusInternalServerError, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"err"</span>: err,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// filePath 要保存在本地的路径(相对)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;filePath := fmt.Sprintf(<span class="string">"./%s"</span>, fileObj.Filename) <span class="comment">// fileObj.Filename: 上传文件的文件名</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 保存文件到本地</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c.SaveUploadedFile(fileObj, filePath)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusOK, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"data"</span>: filePath,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 路由组</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 提交文件默认是32MB大小</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.MaxMultipartMemory = <span class="number">8</span>&lt;&lt;<span class="number">20</span> <span class="comment">// 8MB</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 接受文件</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.POST(<span class="string">"/file"</span>, fileHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h6 id="多文件">多文件</h6>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fileHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;form, err := c.MultipartForm()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;files := form.File[<span class="string">"file"</span>]</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> index, file := <span class="keyword">range</span> files {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// index 顺序</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(index)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst := fmt.Sprintf(<span class="string">"./%s"</span>, file.Filename)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.SaveUploadedFile(file, dst)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 路由组</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 提交文件默认是32MB大小</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.MaxMultipartMemory = <span class="number">8</span> &lt;&lt; <span class="number">20</span> <span class="comment">// 8MB</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 接受文件</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.POST(<span class="string">"/file"</span>, fileHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Gin中间件">Gin中间件</h4>
<blockquote>
<p>比如某些接口我们需要用户登陆后才可以进行操作, 这时候我们可以在每个函数内引用一次判断, 但是中间件可以统一并轻松的做到这一点.</p>
<p>中间件的信息传递使用 c.Set(“key”, “v”), 上文设置k,v, 下文使用 c.MustGet(“key”) 即可获得反射的值, 使用类型断言 比如 c.MustGet(“key”).(string)转字符串类型</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"time"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 统计耗时的中间件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">castTime</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 获取当前时间</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;startTime := time.Now()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 运行下一个注册的Handler函数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c.Next()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 统计耗时</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;cast := time.Since(startTime)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(cast)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 路由组</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Default默认使用Use 加了两个全局中间件, Logger(), Recovery(), Logger是打印日志, Recovery是panic返回500</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// (全局中间件) r.Use代表全局中间件</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Use(castTime)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// (单url中间件) 路由注册时可以写多个函数, 请求进入先进第一个再往后走, 可以做中间件</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.GET(<span class="string">"/index"</span>, castTime, indexHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// (组中间件)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;apiV1Group := r.Group(<span class="string">"/api/v1"</span>, castTime)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apiV1Group.GET(<span class="string">"/index"</span>, v1IndexHandler) <span class="comment">// URL: /api/v1/index</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apiV1Group.GET(<span class="string">"/home"</span>, v1HomeHandler) <span class="comment">// URL: /api/v1/home</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="参数绑定">参数绑定</h4>
<blockquote>
<p>我们处理用户请求的时候, 使用结构体绑定的方法来与用户发送的数据结合,往往能使代码更加简洁, 这就也是参数绑定</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"net/http"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 数据绑定</span></span><br><span class="line"><span class="comment">// User struct</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// form tag 代表该字段对应的请求字段名, binding tag 代表没接收到传错(不写默认不报错)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Username <span class="type">string</span> <span class="string">`form:"username" json:"username" binding:"required"`</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Password <span class="type">string</span> <span class="string">`form:"password" json:"password" binding:"required"`</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> c.Request.Method == <span class="string">"POST"</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 实例化</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> u User</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 将结构体u与用户传来的字段进行绑定(根据Content-Type来按格式解析)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err := c.ShouldBind(&amp;u)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusOK, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"err"</span>: err.Error(),</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 绑定成功,拿到数据</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(u)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 路由组</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Default默认使用Use 加了两个全局中间件, Logger(), Recovery(), Logger是打印日志, Recovery是panic返回500</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Any代表匹配所有请求方式</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Any(<span class="string">"/index"</span>, indexHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Gin连表查询">Gin连表查询</h4>
<blockquote>
<p>多表联合查询, 业务中常见的查询</p>
</blockquote>
<p>跨表查询我们可以使用多种途径应对</p>
<h6 id="sqlx结构体嵌套">sqlx结构体嵌套</h6>
<p>因为sqlx传入的是一个结构体, 而与数据库的同步需要对照 db 的 tag, 所以我们可以使用结构体嵌套<br>
要注意的是结构体嵌套过程中务必避免结构体的字段相同否则只会返回最外面的结构体(实际上只是 c.JSON 时出现的错误)<br>
<img src="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172850342-877493789.png" alt=""></p>
<h6 id="sqlx结构体不镶嵌">sqlx结构体不镶嵌</h6>
<p>我们也可以直接将所有返回值写一个结构体里<br>
<img src="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172923017-638428184.png" alt=""></p>
<h6 id="sql">sql</h6>
<p>我们不使用sqlx模块, 而是直接赋值给变量, 再组合拿到想要的结果也是可以的</p>
<h2 id="logrus模块-日志">logrus模块(日志)</h2>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/go_logrus/">https://www.liwenzhou.com/posts/Go/go_logrus/</a><br>
<img src="https://img2020.cnblogs.com/blog/1268810/202003/1268810-20200303172948498-163058279.png" alt=""></p>
<h4 id="使用-2">使用</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="comment">// logrous</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;log <span class="string">"github.com/sirupsen/logrus"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置此项输出的日志为JSON格式</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;log.SetFormatter(&amp;log.JSONFormatter{})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置此项有字段表示打印日志的文件位置(对性能有影响,不推荐线上使用)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;log.SetReportCaller(<span class="literal">true</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 终端打印日志</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Userinf := log.WithFields(log.Fields{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"name"</span>: <span class="string">"t1"</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"age"</span>: <span class="number">3000</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// .Info指级别</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Userinf.Info(<span class="string">"user info"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// time="2019-08-22T16:36:00+08:00" level=info msg="user info" age=3000 name=t1</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;log.Info(<span class="string">"info"</span>) <span class="comment">// 可不加自定义key/v</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// time="2019-08-22T17:08:16+08:00" level=info msg=info</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="搭配Gin使用">搭配Gin使用</h4>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/go_logrus/#autoid-0-12-0">https://www.liwenzhou.com/posts/Go/go_logrus/#autoid-0-12-0</a></p>
<h4 id="安装-3">安装</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u github.com/sirupsen/logrus</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Cookie-Session">Cookie/Session</h2>
<blockquote>
<p>HTTP 协议是无状态的, 所以需要Cookie和Session来保存一些状态/标识</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/Cookie_Session/">https://www.liwenzhou.com/posts/Go/Cookie_Session/</a></p>
<h4 id="Cookie">Cookie</h4>
<blockquote>
<p>Cookie 本质上是存储在浏览器上的多个键值对, 是保存于某个文件中</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"fmt"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"net/http"</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// Cookie示例</span></span><br><span class="line"><span class="comment">// User struct</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// form tag 代表该字段对应的请求字段名, binding tag 代表没接收到传错(不写默认不报错)</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Username <span class="type">string</span> <span class="string">`form:"username" json:"username" binding:"required"`</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;Password <span class="type">string</span> <span class="string">`form:"password" json:"password" binding:"required"`</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getCookie</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;username, err := c.Cookie(<span class="string">"username"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusOK, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"code"</span>: <span class="number">1005</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 设置username并执行下一个函数</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c.Set(<span class="string">"username"</span>, username)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;c.Next()</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cookieHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// GET验证Cookie</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> c.Request.Method == <span class="string">"GET"</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;username, ok := c.Get(<span class="string">"username"</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> ok {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 取到</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(username.(<span class="type">string</span>))</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 没取到</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusOK, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"code"</span>: <span class="number">1008</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// POST生成Cookie</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> c.Request.Method == <span class="string">"post"</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 参数绑定</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span> u User</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err := c.ShouldBind(&amp;u)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusOK, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"code"</span>: <span class="number">1001</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 身份验证</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> u.Username == <span class="string">"t1"</span> &amp;&amp; u.Password == <span class="string">"t1p"</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// 生成Cookie</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.SetCookie(<span class="string">"username"</span>, u.Username, <span class="number">20</span>, <span class="string">"/"</span>, <span class="string">"127.0.0.1"</span>, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else</span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.JSON(http.StatusOK, gin.H{</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"code"</span>: <span class="number">1003</span>,</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r := gin.Default()</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Any(<span class="string">"/cookie"</span>, getCookie, cookieHandler)</span><br><span class="line">&nbsp;&nbsp;&nbsp;&nbsp;r.Run(<span class="string">"127.0.0.1:9000"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Session">Session</h4>
<blockquote>
<p>Cookie是保存在浏览器端的, 所以Cookie有被人篡改或仿造的危险, 而且Cookie最大支持4KB的数据, 所以Session出现了</p>
<p>Session实际上是在服务器端保存用户的信息, 然后随机生成一个标识返回给浏览器Cookie, Cookie相当于这个钥匙, 拿到钥匙才能证明你的身份, 而且所有数据都在服务端, 客户端只有钥匙, 加大了安全性</p>
<p>Session是保存在服务器的键值对</p>
<p>Session必须依赖Cookie</p>
</blockquote>
</div><div class="article-licensing box"><div class="licensing-title"><p>go 基础笔记存档</p><p><a href="https://www.chnmig.com/2021/09/04/go_base/">https://www.chnmig.com/2021/09/04/go_base/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>ChnMig</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-09-04</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-09-04</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Golang/">Golang</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/09/04/flask_upload_file_504/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">记一次flask框架返回200前端却拿到了504的问题</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/09/04/go_cron/"><span class="level-item">使用Cron定时任务模块</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#前言-3"><span class="level-left"><span class="level-item">1</span><span class="level-item">前言</span></span></a></li><li><a class="level is-mobile" href="#查看官方文档"><span class="level-left"><span class="level-item">2</span><span class="level-item">查看官方文档</span></span></a></li><li><a class="level is-mobile" href="#该系列参照了大佬的学习路线-加上本人的代码实践-大佬链接"><span class="level-left"><span class="level-item">3</span><span class="level-item">该系列参照了大佬的学习路线,加上本人的代码实践,大佬链接</span></span></a></li><li><a class="level is-mobile" href="#目录结构"><span class="level-left"><span class="level-item">4</span><span class="level-item">目录结构</span></span></a></li><li><a class="level is-mobile" href="#双引号单引号"><span class="level-left"><span class="level-item">5</span><span class="level-item">双引号单引号</span></span></a></li><li><a class="level is-mobile" href="#编译代码"><span class="level-left"><span class="level-item">6</span><span class="level-item">编译代码</span></span></a></li><li><a class="level is-mobile" href="#main-go"><span class="level-left"><span class="level-item">7</span><span class="level-item">main.go</span></span></a></li><li><a class="level is-mobile" href="#调试代码"><span class="level-left"><span class="level-item">8</span><span class="level-item">调试代码</span></span></a></li><li><a class="level is-mobile" href="#设置生成文件的格式-跨平台"><span class="level-left"><span class="level-item">9</span><span class="level-item">设置生成文件的格式(跨平台)</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#命令行"><span class="level-left"><span class="level-item">9.1.1</span><span class="level-item">命令行</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#git控制"><span class="level-left"><span class="level-item">10</span><span class="level-item">git控制</span></span></a></li><li><a class="level is-mobile" href="#变量"><span class="level-left"><span class="level-item">11</span><span class="level-item">变量</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#引用类型和值类型"><span class="level-left"><span class="level-item">11.1.1</span><span class="level-item">引用类型和值类型</span></span></a></li><li><a class="level is-mobile" href="#声明单个变量"><span class="level-left"><span class="level-item">11.1.2</span><span class="level-item">声明单个变量</span></span></a></li><li><a class="level is-mobile" href="#声明多个变量"><span class="level-left"><span class="level-item">11.1.3</span><span class="level-item">声明多个变量</span></span></a></li><li><a class="level is-mobile" href="#变量默认值"><span class="level-left"><span class="level-item">11.1.4</span><span class="level-item">变量默认值</span></span></a></li><li><a class="level is-mobile" href="#变量声明时指定值"><span class="level-left"><span class="level-item">11.1.5</span><span class="level-item">变量声明时指定值</span></span></a></li><li><a class="level is-mobile" href="#声明变量时直接指定变量类型"><span class="level-left"><span class="level-item">11.1.6</span><span class="level-item">声明变量时直接指定变量类型</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#fmt模块"><span class="level-left"><span class="level-item">12</span><span class="level-item">fmt模块</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#导入"><span class="level-left"><span class="level-item">12.1.1</span><span class="level-item">导入</span></span></a></li><li><a class="level is-mobile" href="#带换行输出"><span class="level-left"><span class="level-item">12.1.2</span><span class="level-item">带换行输出</span></span></a></li><li><a class="level is-mobile" href="#格式化-带换行-输出"><span class="level-left"><span class="level-item">12.1.3</span><span class="level-item">格式化(带换行)输出</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#短变量声明"><span class="level-left"><span class="level-item">13</span><span class="level-item">短变量声明</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#声明短变量"><span class="level-left"><span class="level-item">13.1.1</span><span class="level-item">声明短变量</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#函数返回值"><span class="level-left"><span class="level-item">14</span><span class="level-item">函数返回值</span></span></a></li><li><a class="level is-mobile" href="#匿名变量"><span class="level-left"><span class="level-item">15</span><span class="level-item">匿名变量</span></span></a></li><li><a class="level is-mobile" href="#常量"><span class="level-left"><span class="level-item">16</span><span class="level-item">常量</span></span></a></li><li><a class="level is-mobile" href="#枚举"><span class="level-left"><span class="level-item">17</span><span class="level-item">枚举</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#经典题目"><span class="level-left"><span class="level-item">17.1.1</span><span class="level-item">经典题目</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#数据类型1"><span class="level-left"><span class="level-item">18</span><span class="level-item">数据类型1</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#整型"><span class="level-left"><span class="level-item">18.1.1</span><span class="level-item">整型</span></span></a></li><li><a class="level is-mobile" href="#len"><span class="level-left"><span class="level-item">18.1.2</span><span class="level-item">len</span></span></a></li><li><a class="level is-mobile" href="#进制"><span class="level-left"><span class="level-item">18.1.3</span><span class="level-item">进制</span></span></a></li><li><a class="level is-mobile" href="#方法2"><span class="level-left"><span class="level-item">18.1.4</span><span class="level-item">方法2</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#数据类型1-补充"><span class="level-left"><span class="level-item">19</span><span class="level-item">数据类型1(补充)</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#布尔"><span class="level-left"><span class="level-item">19.1.1</span><span class="level-item">布尔</span></span></a></li><li><a class="level is-mobile" href="#字符串"><span class="level-left"><span class="level-item">19.1.2</span><span class="level-item">字符串</span></span></a></li><li><a class="level is-mobile" href="#字符串转义"><span class="level-left"><span class="level-item">19.1.3</span><span class="level-item">字符串转义</span></span></a></li><li><a class="level is-mobile" href="#多行字符串"><span class="level-left"><span class="level-item">19.1.4</span><span class="level-item">多行字符串</span></span></a></li><li><a class="level is-mobile" href="#字符串常用方法"><span class="level-left"><span class="level-item">19.1.5</span><span class="level-item">字符串常用方法</span></span></a></li><li><a class="level is-mobile" href="#byte和rune类型"><span class="level-left"><span class="level-item">19.1.6</span><span class="level-item">byte和rune类型</span></span></a></li><li><a class="level is-mobile" href="#类型强制转换"><span class="level-left"><span class="level-item">19.1.7</span><span class="level-item">类型强制转换</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#流程控制"><span class="level-left"><span class="level-item">20</span><span class="level-item">流程控制</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#if"><span class="level-left"><span class="level-item">20.1.1</span><span class="level-item">if</span></span></a></li><li><a class="level is-mobile" href="#for"><span class="level-left"><span class="level-item">20.1.2</span><span class="level-item">for</span></span></a></li><li><a class="level is-mobile" href="#switch"><span class="level-left"><span class="level-item">20.1.3</span><span class="level-item">switch</span></span></a></li><li><a class="level is-mobile" href="#break-和-continue"><span class="level-left"><span class="level-item">20.1.4</span><span class="level-item">break 和 continue</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#fmt模块-2"><span class="level-left"><span class="level-item">21</span><span class="level-item">fmt模块</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#println"><span class="level-left"><span class="level-item">21.1.1</span><span class="level-item">println</span></span></a></li><li><a class="level is-mobile" href="#printf"><span class="level-left"><span class="level-item">21.1.2</span><span class="level-item">printf</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#数组"><span class="level-left"><span class="level-item">22</span><span class="level-item">数组</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#自动判断几位"><span class="level-left"><span class="level-item">22.1.1</span><span class="level-item">自动判断几位</span></span></a></li><li><a class="level is-mobile" href="#根据索引赋值"><span class="level-left"><span class="level-item">22.1.2</span><span class="level-item">根据索引赋值</span></span></a></li><li><a class="level is-mobile" href="#数组的遍历"><span class="level-left"><span class="level-item">22.1.3</span><span class="level-item">数组的遍历</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#多维数组"><span class="level-left"><span class="level-item">23</span><span class="level-item">多维数组</span></span></a></li><li><a class="level is-mobile" href="#切片"><span class="level-left"><span class="level-item">24</span><span class="level-item">切片</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#切片扩容"><span class="level-left"><span class="level-item">24.1.1</span><span class="level-item">切片扩容</span></span></a></li><li><a class="level is-mobile" href="#切片COPY"><span class="level-left"><span class="level-item">24.1.2</span><span class="level-item">切片COPY</span></span></a></li><li><a class="level is-mobile" href="#切片内容的删除"><span class="level-left"><span class="level-item">24.1.3</span><span class="level-item">切片内容的删除</span></span></a></li><li><a class="level is-mobile" href="#难题"><span class="level-left"><span class="level-item">24.1.4</span><span class="level-item">难题</span></span></a></li><li><a class="level is-mobile" href="#数组排序"><span class="level-left"><span class="level-item">24.1.5</span><span class="level-item">数组排序</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#map"><span class="level-left"><span class="level-item">25</span><span class="level-item">map</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#map常用方法"><span class="level-left"><span class="level-item">25.1.1</span><span class="level-item">map常用方法</span></span></a></li><li><a class="level is-mobile" href="#切片与map混合"><span class="level-left"><span class="level-item">25.1.2</span><span class="level-item">切片与map混合</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#函数"><span class="level-left"><span class="level-item">26</span><span class="level-item">函数</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#函数组成"><span class="level-left"><span class="level-item">26.1.1</span><span class="level-item">函数组成</span></span></a></li><li><a class="level is-mobile" href="#函数接收n个参数"><span class="level-left"><span class="level-item">26.1.2</span><span class="level-item">函数接收n个参数</span></span></a></li><li><a class="level is-mobile" href="#函数返回多个值"><span class="level-left"><span class="level-item">26.1.3</span><span class="level-item">函数返回多个值</span></span></a></li><li><a class="level is-mobile" href="#defer"><span class="level-left"><span class="level-item">26.1.4</span><span class="level-item">defer</span></span></a></li><li><a class="level is-mobile" href="#变量作用域"><span class="level-left"><span class="level-item">26.1.5</span><span class="level-item">变量作用域</span></span></a></li><li><a class="level is-mobile" href="#将函数作为参数"><span class="level-left"><span class="level-item">26.1.6</span><span class="level-item">将函数作为参数</span></span></a></li><li><a class="level is-mobile" href="#匿名函数"><span class="level-left"><span class="level-item">26.1.7</span><span class="level-item">匿名函数</span></span></a></li><li><a class="level is-mobile" href="#闭包"><span class="level-left"><span class="level-item">26.1.8</span><span class="level-item">闭包</span></span></a></li><li><a class="level is-mobile" href="#内置函数"><span class="level-left"><span class="level-item">26.1.9</span><span class="level-item">内置函数</span></span></a></li><li><a class="level is-mobile" href="#panic-recover"><span class="level-left"><span class="level-item">26.1.10</span><span class="level-item">panic/recover</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#指针"><span class="level-left"><span class="level-item">27</span><span class="level-item">指针</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#指针与地址"><span class="level-left"><span class="level-item">27.1.1</span><span class="level-item">指针与地址</span></span></a></li><li><a class="level is-mobile" href="#建立指针"><span class="level-left"><span class="level-item">27.1.2</span><span class="level-item">建立指针</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#结构体-struct-和方法"><span class="level-left"><span class="level-item">28</span><span class="level-item">结构体(struct)和方法</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#创建自定义类型和给类型起别名"><span class="level-left"><span class="level-item">28.1.1</span><span class="level-item">创建自定义类型和给类型起别名</span></span></a></li><li><a class="level is-mobile" href="#结构体"><span class="level-left"><span class="level-item">28.1.2</span><span class="level-item">结构体</span></span></a></li><li><a class="level is-mobile" href="#基本实例化"><span class="level-left"><span class="level-item">28.1.3</span><span class="level-item">基本实例化</span></span></a></li><li><a class="level is-mobile" href="#基本初始化"><span class="level-left"><span class="level-item">28.1.4</span><span class="level-item">基本初始化</span></span></a></li><li><a class="level is-mobile" href="#结构体内存"><span class="level-left"><span class="level-item">28.1.5</span><span class="level-item">结构体内存</span></span></a></li><li><a class="level is-mobile" href="#结构体嵌套"><span class="level-left"><span class="level-item">28.1.6</span><span class="level-item">结构体嵌套</span></span></a></li><li><a class="level is-mobile" href="#赋值给指针"><span class="level-left"><span class="level-item">28.1.7</span><span class="level-item">赋值给指针</span></span></a></li><li><a class="level is-mobile" href="#构造函数"><span class="level-left"><span class="level-item">28.1.8</span><span class="level-item">构造函数</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#方法和接收者"><span class="level-left"><span class="level-item">29</span><span class="level-item">方法和接收者</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#什么时候使用指针接受者"><span class="level-left"><span class="level-item">29.1.1</span><span class="level-item">什么时候使用指针接受者</span></span></a></li><li><a class="level is-mobile" href="#方法的追加"><span class="level-left"><span class="level-item">29.1.2</span><span class="level-item">方法的追加</span></span></a></li><li><a class="level is-mobile" href="#结构体镶嵌达到继承的效果"><span class="level-left"><span class="level-item">29.1.3</span><span class="level-item">结构体镶嵌达到继承的效果</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#获取用户输入信息"><span class="level-left"><span class="level-item">30</span><span class="level-item">获取用户输入信息</span></span></a></li><li><a class="level is-mobile" href="#程序的退出"><span class="level-left"><span class="level-item">31</span><span class="level-item">程序的退出</span></span></a></li><li><a class="level is-mobile" href="#匿名字段"><span class="level-left"><span class="level-item">32</span><span class="level-item">匿名字段</span></span></a></li><li><a class="level is-mobile" href="#JSON序列化"><span class="level-left"><span class="level-item">33</span><span class="level-item">JSON序列化</span></span></a></li><li><a class="level is-mobile" href="#defore深入理解"><span class="level-left"><span class="level-item">34</span><span class="level-item">defore深入理解</span></span></a></li><li><a class="level is-mobile" href="#Go语言的包"><span class="level-left"><span class="level-item">35</span><span class="level-item">Go语言的包</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#定义包"><span class="level-left"><span class="level-item">35.1.1</span><span class="level-item">定义包</span></span></a></li><li><a class="level is-mobile" href="#可见性"><span class="level-left"><span class="level-item">35.1.2</span><span class="level-item">可见性</span></span></a></li><li><a class="level is-mobile" href="#导入包"><span class="level-left"><span class="level-item">35.1.3</span><span class="level-item">导入包</span></span></a></li><li><a class="level is-mobile" href="#匿名导入包"><span class="level-left"><span class="level-item">35.1.4</span><span class="level-item">匿名导入包</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#初始化函数"><span class="level-left"><span class="level-item">36</span><span class="level-item">初始化函数</span></span></a></li><li><a class="level is-mobile" href="#time包"><span class="level-left"><span class="level-item">37</span><span class="level-item">time包</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#时间戳"><span class="level-left"><span class="level-item">37.1.1</span><span class="level-item">时间戳</span></span></a></li><li><a class="level is-mobile" href="#定时器"><span class="level-left"><span class="level-item">37.1.2</span><span class="level-item">定时器</span></span></a></li><li><a class="level is-mobile" href="#时间格式化"><span class="level-left"><span class="level-item">37.1.3</span><span class="level-item">时间格式化</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#接口"><span class="level-left"><span class="level-item">38</span><span class="level-item">接口</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#为什么使用接口"><span class="level-left"><span class="level-item">38.1.1</span><span class="level-item">为什么使用接口</span></span></a></li><li><a class="level is-mobile" href="#接口实现"><span class="level-left"><span class="level-item">38.1.2</span><span class="level-item">接口实现</span></span></a></li><li><a class="level is-mobile" href="#类型与接口的关系"><span class="level-left"><span class="level-item">38.1.3</span><span class="level-item">类型与接口的关系</span></span></a></li><li><a class="level is-mobile" href="#接口的嵌套"><span class="level-left"><span class="level-item">38.1.4</span><span class="level-item">接口的嵌套</span></span></a></li><li><a class="level is-mobile" href="#空接口"><span class="level-left"><span class="level-item">38.1.5</span><span class="level-item">空接口</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#类型断言"><span class="level-left"><span class="level-item">39</span><span class="level-item">类型断言</span></span></a></li><li><a class="level is-mobile" href="#接口值"><span class="level-left"><span class="level-item">40</span><span class="level-item">接口值</span></span></a></li><li><a class="level is-mobile" href="#Go对文件进行操作"><span class="level-left"><span class="level-item">41</span><span class="level-item">Go对文件进行操作</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#打开文件"><span class="level-left"><span class="level-item">41.1.1</span><span class="level-item">打开文件</span></span></a></li><li><a class="level is-mobile" href="#关闭文件"><span class="level-left"><span class="level-item">41.1.2</span><span class="level-item">关闭文件</span></span></a></li><li><a class="level is-mobile" href="#读取文件"><span class="level-left"><span class="level-item">41.1.3</span><span class="level-item">读取文件</span></span></a></li><li><a class="level is-mobile" href="#初始版"><span class="level-left"><span class="level-item">41.1.4</span><span class="level-item">初始版</span></span></a></li><li><a class="level is-mobile" href="#bufio读取文件"><span class="level-left"><span class="level-item">41.1.5</span><span class="level-item">bufio读取文件</span></span></a></li><li><a class="level is-mobile" href="#ioutil读取文件"><span class="level-left"><span class="level-item">41.1.6</span><span class="level-item">ioutil读取文件</span></span></a></li><li><a class="level is-mobile" href="#OpenFile操作文件"><span class="level-left"><span class="level-item">41.1.7</span><span class="level-item">OpenFile操作文件</span></span></a></li><li><a class="level is-mobile" href="#bufio-NewWriter写入文件"><span class="level-left"><span class="level-item">41.1.8</span><span class="level-item">bufio.NewWriter写入文件</span></span></a></li><li><a class="level is-mobile" href="#ioutil-WriteFile写入文件"><span class="level-left"><span class="level-item">41.1.9</span><span class="level-item">ioutil.WriteFile写入文件</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#反射"><span class="level-left"><span class="level-item">42</span><span class="level-item">反射</span></span></a></li><li><a class="level is-mobile" href="#reflect包"><span class="level-left"><span class="level-item">43</span><span class="level-item">reflect包</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#TypeOf"><span class="level-left"><span class="level-item">43.1.1</span><span class="level-item">TypeOf</span></span></a></li><li><a class="level is-mobile" href="#ValueOf"><span class="level-left"><span class="level-item">43.1.2</span><span class="level-item">ValueOf</span></span></a></li><li><a class="level is-mobile" href="#通过反射修改外部变量值"><span class="level-left"><span class="level-item">43.1.3</span><span class="level-item">通过反射修改外部变量值</span></span></a></li><li><a class="level is-mobile" href="#Tag"><span class="level-left"><span class="level-item">43.1.4</span><span class="level-item">Tag</span></span></a></li><li><a class="level is-mobile" href="#结构体反射查看字段"><span class="level-left"><span class="level-item">43.1.5</span><span class="level-item">结构体反射查看字段</span></span></a></li><li><a class="level is-mobile" href="#结构体反射查看方法"><span class="level-left"><span class="level-item">43.1.6</span><span class="level-item">结构体反射查看方法</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#并发"><span class="level-left"><span class="level-item">44</span><span class="level-item">并发</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#并发与并行"><span class="level-left"><span class="level-item">44.1.1</span><span class="level-item">并发与并行</span></span></a></li><li><a class="level is-mobile" href="#进程-线程-协程"><span class="level-left"><span class="level-item">44.1.2</span><span class="level-item">进程,线程,协程</span></span></a></li><li><a class="level is-mobile" href="#goroutine"><span class="level-left"><span class="level-item">44.1.3</span><span class="level-item">goroutine</span></span></a></li><li><a class="level is-mobile" href="#goroutine和线程的区别"><span class="level-left"><span class="level-item">44.1.4</span><span class="level-item">goroutine和线程的区别</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#channel"><span class="level-left"><span class="level-item">45</span><span class="level-item">channel</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#无缓冲通道和缓冲通道"><span class="level-left"><span class="level-item">45.1.1</span><span class="level-item">无缓冲通道和缓冲通道</span></span></a></li><li><a class="level is-mobile" href="#判断通道是否关闭"><span class="level-left"><span class="level-item">45.1.2</span><span class="level-item">判断通道是否关闭</span></span></a></li><li><a class="level is-mobile" href="#select多路复用"><span class="level-left"><span class="level-item">45.1.3</span><span class="level-item">select多路复用</span></span></a></li><li><a class="level is-mobile" href="#单向通道"><span class="level-left"><span class="level-item">45.1.4</span><span class="level-item">单向通道</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#并发控制与锁"><span class="level-left"><span class="level-item">46</span><span class="level-item">并发控制与锁</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#互斥锁"><span class="level-left"><span class="level-item">46.1.1</span><span class="level-item">互斥锁</span></span></a></li><li><a class="level is-mobile" href="#读写互斥锁"><span class="level-left"><span class="level-item">46.1.2</span><span class="level-item">读写互斥锁</span></span></a></li><li><a class="level is-mobile" href="#map的并发"><span class="level-left"><span class="level-item">46.1.3</span><span class="level-item">map的并发</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#单元测试"><span class="level-left"><span class="level-item">47</span><span class="level-item">单元测试</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#Go语言单元测试"><span class="level-left"><span class="level-item">47.1.1</span><span class="level-item">Go语言单元测试</span></span></a></li><li><a class="level is-mobile" href="#基准测试"><span class="level-left"><span class="level-item">47.1.2</span><span class="level-item">基准测试</span></span></a></li><li><a class="level is-mobile" href="#Setup和TearDown"><span class="level-left"><span class="level-item">47.1.3</span><span class="level-item">Setup和TearDown</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#网络编程"><span class="level-left"><span class="level-item">48</span><span class="level-item">网络编程</span></span></a></li><li><a class="level is-mobile" href="#MySql"><span class="level-left"><span class="level-item">49</span><span class="level-item">MySql</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#驱动下载"><span class="level-left"><span class="level-item">49.1.1</span><span class="level-item">驱动下载</span></span></a></li><li><a class="level is-mobile" href="#普通连接"><span class="level-left"><span class="level-item">49.1.2</span><span class="level-item">普通连接</span></span></a></li><li><a class="level is-mobile" href="#连接池连接"><span class="level-left"><span class="level-item">49.1.3</span><span class="level-item">连接池连接</span></span></a></li><li><a class="level is-mobile" href="#占位符"><span class="level-left"><span class="level-item">49.1.4</span><span class="level-item">占位符</span></span></a></li><li><a class="level is-mobile" href="#查询数据"><span class="level-left"><span class="level-item">49.1.5</span><span class="level-item">查询数据</span></span></a></li><li><a class="level is-mobile" href="#插入数据"><span class="level-left"><span class="level-item">49.1.6</span><span class="level-item">插入数据</span></span></a></li><li><a class="level is-mobile" href="#更新数据"><span class="level-left"><span class="level-item">49.1.7</span><span class="level-item">更新数据</span></span></a></li><li><a class="level is-mobile" href="#删除数据"><span class="level-left"><span class="level-item">49.1.8</span><span class="level-item">删除数据</span></span></a></li><li><a class="level is-mobile" href="#预处理查询"><span class="level-left"><span class="level-item">49.1.9</span><span class="level-item">预处理查询</span></span></a></li><li><a class="level is-mobile" href="#事务"><span class="level-left"><span class="level-item">49.1.10</span><span class="level-item">事务</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#第三方库-SQLX"><span class="level-left"><span class="level-item">50</span><span class="level-item">第三方库 SQLX</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#安装"><span class="level-left"><span class="level-item">50.1.1</span><span class="level-item">安装</span></span></a></li><li><a class="level is-mobile" href="#事务-2"><span class="level-left"><span class="level-item">50.1.2</span><span class="level-item">事务</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#Go使用Redis"><span class="level-left"><span class="level-item">51</span><span class="level-item">Go使用Redis</span></span></a></li><li><a class="level is-mobile" href="#NSQ消息队列"><span class="level-left"><span class="level-item">52</span><span class="level-item">NSQ消息队列</span></span></a></li><li><a class="level is-mobile" href="#依赖管理-old"><span class="level-left"><span class="level-item">53</span><span class="level-item">依赖管理(old)</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#安装-2"><span class="level-left"><span class="level-item">53.1.1</span><span class="level-item">安装</span></span></a></li><li><a class="level is-mobile" href="#保存依赖信息"><span class="level-left"><span class="level-item">53.1.2</span><span class="level-item">保存依赖信息</span></span></a></li><li><a class="level is-mobile" href="#使用"><span class="level-left"><span class="level-item">53.1.3</span><span class="level-item">使用</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#依赖管理-new"><span class="level-left"><span class="level-item">54</span><span class="level-item">依赖管理(new)</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#go-mod命令"><span class="level-left"><span class="level-item">54.1.1</span><span class="level-item">go mod命令</span></span></a></li><li><a class="level is-mobile" href="#打开mod支持"><span class="level-left"><span class="level-item">54.1.2</span><span class="level-item">打开mod支持</span></span></a></li><li><a class="level is-mobile" href="#生成mod"><span class="level-left"><span class="level-item">54.1.3</span><span class="level-item">生成mod</span></span></a></li><li><a class="level is-mobile" href="#下载依赖"><span class="level-left"><span class="level-item">54.1.4</span><span class="level-item">下载依赖</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#Gin框架"><span class="level-left"><span class="level-item">55</span><span class="level-item">Gin框架</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#安装-更新"><span class="level-left"><span class="level-item">55.1.1</span><span class="level-item">安装/更新</span></span></a></li><li><a class="level is-mobile" href="#基础版"><span class="level-left"><span class="level-item">55.1.2</span><span class="level-item">基础版</span></span></a></li><li><a class="level is-mobile" href="#Gin请求方式"><span class="level-left"><span class="level-item">55.1.3</span><span class="level-item">Gin请求方式</span></span></a></li><li><a class="level is-mobile" href="#Gin的渲染"><span class="level-left"><span class="level-item">55.1.4</span><span class="level-item">Gin的渲染</span></span></a></li><li><a class="level is-mobile" href="#Gin获取参数"><span class="level-left"><span class="level-item">55.1.5</span><span class="level-item">Gin获取参数</span></span></a></li><li><a class="level is-mobile" href="#HTTP跳转"><span class="level-left"><span class="level-item">55.1.6</span><span class="level-item">HTTP跳转</span></span></a></li><li><a class="level is-mobile" href="#路由跳转"><span class="level-left"><span class="level-item">55.1.7</span><span class="level-item">路由跳转</span></span></a></li><li><a class="level is-mobile" href="#Gin路由组"><span class="level-left"><span class="level-item">55.1.8</span><span class="level-item">Gin路由组</span></span></a></li><li><a class="level is-mobile" href="#多文件"><span class="level-left"><span class="level-item">55.1.9</span><span class="level-item">多文件</span></span></a></li><li><a class="level is-mobile" href="#Gin中间件"><span class="level-left"><span class="level-item">55.1.10</span><span class="level-item">Gin中间件</span></span></a></li><li><a class="level is-mobile" href="#参数绑定"><span class="level-left"><span class="level-item">55.1.11</span><span class="level-item">参数绑定</span></span></a></li><li><a class="level is-mobile" href="#sql"><span class="level-left"><span class="level-item">55.1.12</span><span class="level-item">sql</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#logrus模块-日志"><span class="level-left"><span class="level-item">56</span><span class="level-item">logrus模块(日志)</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#使用-2"><span class="level-left"><span class="level-item">56.1.1</span><span class="level-item">使用</span></span></a></li><li><a class="level is-mobile" href="#搭配Gin使用"><span class="level-left"><span class="level-item">56.1.2</span><span class="level-item">搭配Gin使用</span></span></a></li><li><a class="level is-mobile" href="#安装-3"><span class="level-left"><span class="level-item">56.1.3</span><span class="level-item">安装</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#Cookie-Session"><span class="level-left"><span class="level-item">57</span><span class="level-item">Cookie/Session</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#Cookie"><span class="level-left"><span class="level-item">57.1.1</span><span class="level-item">Cookie</span></span></a></li><li><a class="level is-mobile" href="#Session"><span class="level-left"><span class="level-item">57.1.2</span><span class="level-item">Session</span></span></a></li></ul></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/logo.gif" alt="ChnMig的个人网站" height="28"></a><p class="is-size-7"><span>&copy; 2022 ChnMig</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Contact me" href="mailto:ChnMig@Outlook.com"><i class="far fa-envelope"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ChnMig"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>