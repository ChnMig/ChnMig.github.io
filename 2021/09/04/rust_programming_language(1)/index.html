<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Rust程序设计语言(1) - ChnMig的个人网站</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="ChnMig的个人网站"><meta name="msapplication-TileImage" content="/images/logo.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ChnMig的个人网站"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="HelloWorld! Rust从安装到放弃"><meta property="og:type" content="blog"><meta property="og:title" content="Rust程序设计语言(1)"><meta property="og:url" content="https://chnmig.github.io/2021/09/04/rust_programming_language(1)/"><meta property="og:site_name" content="ChnMig的个人网站"><meta property="og:description" content="HelloWorld! Rust从安装到放弃"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://chnmig.github.io/img/og_image.png"><meta property="article:published_time" content="2021-09-03T16:00:00.000Z"><meta property="article:modified_time" content="2021-09-03T16:00:00.000Z"><meta property="article:author" content="ChnMig"><meta property="article:tag" content="Rust"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://chnmig.github.io/2021/09/04/rust_programming_language(1)/"},"headline":"Rust程序设计语言(1)","image":["https://chnmig.github.io/img/og_image.png"],"datePublished":"2021-09-03T16:00:00.000Z","dateModified":"2021-09-03T16:00:00.000Z","author":{"@type":"Person","name":"ChnMig"},"publisher":{"@type":"Organization","name":"ChnMig的个人网站","logo":{"@type":"ImageObject","url":"https://chnmig.github.io/images/logo.gif"}},"description":"HelloWorld! Rust从安装到放弃"}</script><link rel="canonical" href="https://chnmig.github.io/2021/09/04/rust_programming_language(1)/"><link rel="icon" href="/images/logo.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?5306a4ae74c103fc71e3fb36eb8f9609";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo.gif" alt="ChnMig的个人网站" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">类别</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a><a class="navbar-item" target="_blank" rel="noopener" href="http://tongji.baidu.com/web/welcome/ico?s=5306a4ae74c103fc71e3fb36eb8f9609">访问统计</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-09-03T16:00:00.000Z" title="2021/9/4 上午12:00:00">2021-09-04</time>发表</span><span class="level-item"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></span><span class="level-item">1 小时读完 (大约7136个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Rust程序设计语言(1)</h1><div class="content"><h2 id="安装">安装</h2>
<p><strong>brew</strong></p>
<p><code>brew install rust</code></p>
<p><strong>其他</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.rust-lang.org/zh-CN/tools/install">官网</a></p>
<p><strong>校验是否安装成功</strong></p>
<p>安装后在命令行输入 <code>rustc --version</code> 如果看到rust的版本号即可, 例如 <code>rustc 1.42.0 (b8cedc004 2020-03-09)</code></p>
<p><strong>打开内置的文档</strong></p>
<p>命令行输入 <code>rustup doc</code>, 会调用默认浏览器打开本地的内置文档</p>
<h2 id="VsCode配置插件">VsCode配置插件</h2>
<p>插件商城输入 rust, 排第一的就是, 安装后打开rust项目会提示下载依赖, 同意即可</p>
<h2 id="Hello-world">Hello,world</h2>
<blockquote>
<p>编写一个输出 hello, world 的程序</p>
</blockquote>
<h3 id="编写与执行">编写与执行</h3>
<p>在某个地方新建文件夹 <code>hello_world</code> , 在文件夹下新建文件 <code>main.rs</code> , 编写代码如下</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"hello, world"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>保存后在当前目录下执行命令 <code>rustc main.rs </code> 会生成可执行文件 <code>main</code>, 执行这个文件, 打印 <code>hello, world</code>, 例如</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  hello_world rustc main.rs </span><br><span class="line">➜  hello_world ./main </span><br><span class="line">hello, world</span><br><span class="line">➜  hello_world </span><br></pre></td></tr></tbody></table></figure>
<h3 id="解析">解析</h3>
<ul>
<li>rust的代码写在 <code>.rs</code> 后缀的文件中</li>
<li>rust推荐使用下划线方法来命名, 比如 <code>hello_world</code> 而不是 <code>helloWorld</code> 或者 <code>helloworld</code></li>
<li>rust的缩进是4个空格而不是一个tab</li>
</ul>
<p>我们来解析代码</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>fn代表定义一个函数, 这里定义了一个 <code>main</code> 函数, main函数是特殊的函数, 每个可执行的rust程序都从main函数开始, <code>main()</code> 代表这个函数不需要任何参数, 如果有的话应该定义在 <code>()</code> 中.</p>
<p><code>()</code> 后直接跟的 <code>{}</code> 代表函数本体, rust要求函数内部的代码都被这个大括号包裹, 而 <code>main(){}</code> 也代表了这个函数没有任何的返回值, 一般来说 <code>{</code> 与函数名在同一行, 并使用空格分开</p>
<p>rust的新版本自带了代码的格式化工具 <code>rust fmt</code>, 使用他可以将你的代码格式化的更加规范</p>
<p>在当前命令行中使用 <code>rustfmt main.rs</code></p>
<p>查看格式化后的代码, 如果你的代码原来是</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {<span class="built_in">println!</span>(<span class="string">"hello, world"</span>);}</span><br></pre></td></tr></tbody></table></figure>
<p>格式化之后变成了</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"hello, world"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>而其中的</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">println!</span>(<span class="string">"hello, world"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>则是函数的逻辑, 上面说到了缩进是四个空格</p>
<p><code>println!</code> 是rust内置的宏(macro), 类似于内置的语法, 而引入内置的函数则是 <code>println</code>, 这个之后再说明</p>
<p><code>"hello, world"</code>是传入这个宏的参数, 是一个字符串, 然后该字符串就会被输出到命令行中</p>
<p>rust中使用 <code>;</code> 作为一行的结束, 代表这个表达式结束, 下一个表达式开始</p>
<h3 id="编译">编译</h3>
<p>rust是一门静态语言, 他也是需要编译的, 还记得我们写完后在命令行输入 <code>rustc main.rs</code> 吗, 这就是在编译代码, 编译完成后会生成编译平台可执行的文件</p>
<h2 id="hello-cargo">hello, cargo</h2>
<blockquote>
<p>认识cargo</p>
</blockquote>
<p><code>cargo</code> 是rust的构建系统和依赖管理工具, 类似于golang的 go mod</p>
<p>在实际的编写项目中, 常常需要引入第三方的函数, 此时我们就需要 cargo 来帮助我们管理</p>
<p>cargo在安装 rust 时就已经安装到了你的电脑中</p>
<p>你可以在命令行中输入</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo --version</span><br></pre></td></tr></tbody></table></figure>
<p>来查看cargo的版本, 例如 <code>cargo 1.42.0 (86334295e 2020-01-31)</code></p>
<h3 id="使用cargo建立项目">使用cargo建立项目</h3>
<p>正常情况下我们一般使用 cargo 来建立新项目, 而不是手动建立文件夹</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  student ls</span><br><span class="line">➜  student cargo new hello_cargo</span><br><span class="line">     Created binary (application) `hello_cargo` package</span><br><span class="line">➜  student ls</span><br><span class="line">hello_cargo</span><br></pre></td></tr></tbody></table></figure>
<p>可以看到, 在执行 <code>cargo new hello_cargo</code> 之后, 原本空的文件夹下出现了 <code>hello_cargo</code> 文件夹, 这与我们执行 new 时的输入是相同的</p>
<p>我们的项目就在这里</p>
<p>里面已经多了几个文件, 目录树如下</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── .git</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   ├── config</span><br><span class="line">│   ├── description</span><br><span class="line">│   ├── hooks</span><br><span class="line">│   │   └── README.sample</span><br><span class="line">│   ├── info</span><br><span class="line">│   │   └── exclude</span><br><span class="line">│   ├── objects</span><br><span class="line">│   │   ├── info</span><br><span class="line">│   │   └── pack</span><br><span class="line">│   └── refs</span><br><span class="line">│       ├── heads</span><br><span class="line">│       └── tags</span><br><span class="line">├── .gitignore</span><br><span class="line">├── Cargo.toml</span><br><span class="line">└── src</span><br><span class="line">    └── main.rs</span><br></pre></td></tr></tbody></table></figure>
<p>可以看到, cargo会在 hello-cargo 下初始化 git, 并且为我们生成了 .gitignore 忽略文件, 其中默认忽略了 <code>/target</code> 目录, 我们之后再介绍这个文件夹</p>
<p>同时生成了 cargo.toml 文件, <a target="_blank" rel="noopener" href="https://toml.io/en/">toml</a>格式是一种配置文件的格式, 他的内容大致如下</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"hello_cargo"</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">"0.1.0"</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">"example &lt;example@example.com&gt;"</span>]</span><br><span class="line"><span class="attr">edition</span> = <span class="string">"2018"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br></pre></td></tr></tbody></table></figure>
<p>其中, package下为项目的信息, name为项目名, version为版本, authors为创建人(读取git的信息), edition这个项目创建时的大版本号, 目前是2018</p>
<p>里面的Value内容是可以修改的, 如果信息不准确你可以手动进行修改</p>
<p>我们真正的代码在 <code>src/main.rs</code> 中, 里面已经默认添加了 main 函数</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Hello, world!"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>rust希望你将所有的源代码放置在这个src目录下, 在根目录只放置 <a target="_blank" rel="noopener" href="http://README.md/">README.md/</a> 配置文件 等不涉及到代码的东西</li>
<li>如果当前目录已经在 git 的控制下, 那么使用 <code>cargo new</code> 默认不会创建git相关的文件, 但是你可以使用参数 <code>--vcs=git</code> 来强制创建, 更多用法可查看 <code>cargo new --help</code></li>
</ul>
<h3 id="执行cargo">执行cargo</h3>
<p><strong>cargo build</strong></p>
<p>在命令行执行</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  hello_cargo git:(master) ✗ cargo build</span><br><span class="line">   Compiling hello_cargo v0.1.0 (/Users/Work/Code/Rust/student/hello_cargo)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.76s</span><br></pre></td></tr></tbody></table></figure>
<p>我们会发现在目录下生成文件夹 <code>/target</code> 在里面的 <code>/debug</code> 中则有可执行文件 <code>hello_cargo</code></p>
<p>我们执行他</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  hello_cargo git:(master) ✗ ./target/debug/hello_cargo</span><br><span class="line">Hello, world!</span><br></pre></td></tr></tbody></table></figure>
<p>所以, 我们 <code>build</code> 后会把生成的文件放置在 <code>/target/debug</code> 下, 当然 target 下还有很多文件, 我们之后再说</p>
<p>当某个项目第一次build, 还会在根目录生成 <code>Cargo.lock</code> 文件, 里面会存放一些具体的依赖, 一般不需要我们修改</p>
<p><strong>cargo run</strong></p>
<p>我们也可以使用 <code>cargo run</code> 来直接运行 <code>build</code> 出的程序, 与上面的方式没有区别</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  hello_cargo git:(master) ✗ cargo run</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.00s</span><br><span class="line">     Running `target/debug/hello_cargo`</span><br><span class="line">Hello, world!</span><br></pre></td></tr></tbody></table></figure>
<p>更强大的是, 如果你修改了源代码, 此时你无需执行 <code>build</code>, 直接执行 <code>run</code> 可自行 <code>build</code>然后执行</p>
<p>比如我们将 <code>main.rs</code> 修改为</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Hello, world!"</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Hello, world!"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>保存后直接执行 <code>cargo run</code></p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  hello_cargo git:(master) ✗ cargo run</span><br><span class="line">   Compiling hello_cargo v0.<span class="number">1.0</span> (/Users/Work/Code/Rust/student/hello_cargo)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> <span class="number">0.27</span>s</span><br><span class="line">     Running `target/debug/hello_cargo`</span><br><span class="line">Hello, world!</span><br><span class="line">Hello, world!</span><br></pre></td></tr></tbody></table></figure>
<p>如果你事先没有 build, 也就是没有 target 文件夹, 执行 <code>cargo run</code>也会自己build</p>
<p><strong>cargo check</strong></p>
<p>如果你只想确认你编写的代码是否可以运行而不想build出文件, 可以执行 <code>cargo check</code>, 可以在不生成可执行文件的前提下检查你的代码是否可以编译</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  hello_cargo git:(master) ✗ cargo check</span><br><span class="line">    Checking hello_cargo v0.<span class="number">1.0</span> (/Users/chenming/Work/Code/Rust/student/hello_cargo)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> <span class="number">0.13</span>s</span><br></pre></td></tr></tbody></table></figure>
<p><strong>cargo release</strong></p>
<p>当你的项目需要发布或者迁出稳定版的时候, 使用 <code>cargo build --release</code> , 与普通的build不同的是, 该操作会优化生成的可执行文件, 提高执行速度等等, 当然, 因为优化原因, release 的耗时会比普通的 build 慢一些, 编译完成后会放置在 <code>/target/release</code> 文件夹下, 建议每次发布时都采用此方式编译</p>
<p><strong>代码格式化</strong></p>
<p>之前提到对某一个 rs 文件格式化代码使用 <code>rustfmt xx.rs</code></p>
<p>如果对整个项目都格式化, 使用 <code>cargo fmt</code> 即可</p>
<p>如果你只想查看哪些是需要格式化的而不是直接修改好文件, 使用 <code>cargo fmt -- --check</code> 即可</p>
<p><strong>最好对每个项目都是用targo来管理, 这样对项目来讲是最好的</strong></p>
<h2 id="设计猜谜游戏程序">设计猜谜游戏程序</h2>
<blockquote>
<p>这个程序的流程是, 用户输入一个数字, 然后程序自己随机出一个数字, 将这两个数字进行对比</p>
</blockquote>
<h3 id="建立新项目">建立新项目</h3>
<p>使用 cargo 建立新项目并进入目录</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  student cargo new guessing_game</span><br><span class="line">     Created binary (application) `guessing_game` package</span><br><span class="line">➜  student ls</span><br><span class="line">guessing_game</span><br><span class="line">➜  student <span class="built_in">cd</span> guessing_game </span><br></pre></td></tr></tbody></table></figure>
<p>此时在 <code>/src/main.rs</code> 中已经有一个 main 函数了, 我们修改 main 函数</p>
<h3 id="处理用户输入的数字">处理用户输入的数字</h3>
<p>我们将代码修改成下面的</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io;  <span class="comment">// 引入标准库</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"输入你的猜测数字: "</span>);  <span class="comment">// 打印</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> guess = <span class="built_in">String</span>::new();  <span class="comment">// 创建一个字符串变量guess</span></span><br><span class="line">    io::stdin()  <span class="comment">// 调用stdin</span></span><br><span class="line">        .read_line(&amp;<span class="keyword">mut</span> guess)  <span class="comment">// 调用stdin的方法read_line获取输入值</span></span><br><span class="line">        .expect(<span class="string">"读取失败"</span>);  <span class="comment">// 如果获取错误打印警告</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"你猜测的数字是: {}"</span>, guess)  <span class="comment">// 输出获取到的输入</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>值得注意的是, rust的注释是 <code>//</code>, 他不会编译<code>//</code>后的内容直到本行的结尾</p>
<p>这段代码的目的是读取用户输入的数字并输出</p>
<p>在第一行, 我们使用 <code>use</code> 语法来引入标准库 <code>std::io</code>, 类似于Python/Go的<code>import</code></p>
<p>我们首先在输入框中输出提示 <code>输入你的猜测数字: </code></p>
<p><strong>let</strong></p>
<p>在第5行, 我们使用 <code>let</code> 来创建一个 <code>变量</code>, 但是与其他语言不同的是, 如果你只是使用 <code>let</code>, 那么你创建的变量的值是<strong>不可变的</strong>, 例如以下代码</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">"1212"</span>;</span><br><span class="line">a = <span class="string">"1111"</span> ;</span><br></pre></td></tr></tbody></table></figure>
<p>我们使用 <code>cargo check</code> 来检查会爆出错误</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">error[E0384]: cannot assign twice to immutable variable `a`</span><br><span class="line"> --&gt; src/main.rs:5:5</span><br><span class="line">  |</span><br><span class="line">4 |     <span class="built_in">let</span> a = <span class="string">"1212"</span>;</span><br><span class="line">  |         -</span><br><span class="line">  |         |</span><br><span class="line">  |         first assignment to `a`</span><br><span class="line">  |         <span class="built_in">help</span>: make this binding mutable: `mut a`</span><br><span class="line">5 |     a = <span class="string">"1111"</span> ;</span><br><span class="line">  |     ^^^^^^^^^^ cannot assign twice to immutable variable</span><br><span class="line"></span><br><span class="line">error: aborting due to previous error</span><br></pre></td></tr></tbody></table></figure>
<p>告诉我们不能对不可变的变量进行二次赋值</p>
<p>所以, 如果这个变量在以后需要重新赋值, 我们需要使用 <code>let mut</code></p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> a = <span class="string">"1212"</span>;</span><br><span class="line">a = <span class="string">"1111"</span> ;</span><br></pre></td></tr></tbody></table></figure>
<p>对于新建变量来说, 还是要根据用途来进行设计</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> a = <span class="string">"1212"</span>;  <span class="comment">// 可变变量</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="string">"dddd"</span>  <span class="comment">// 不可变变量</span></span><br></pre></td></tr></tbody></table></figure>
<p>回到代码中, 我们看到, 我们新建了一个可变变量 guess, 他的值是 <code>String::new()</code> , 代表着使用了 <code>String</code> 的<code>new</code> 方法, 生成了一个 <code>String</code> 实例, <code>String</code> 代表着 rust 的字符串类型, 那么, <code>String::new()</code>代表生成了一个字符串类型的初始值, 也就是空字符串</p>
<p><code>::new</code> 代表调用 <code>new</code> 方法, <code>new</code>对于<code>String</code> 来说是<strong>关联函数(<strong>associated function</strong>)</strong> , 通常我们认为<code>new</code>是<code>String</code> 的<strong>静态方法</strong>, 一些面向对象的语言通常都有这个概念, 指的是类自有的方法, 而不需要对象去调用</p>
<p>在 rust 中, 新建一个新的类型的初始值通常使用 <code>::new</code></p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">io::stdin()  <span class="comment">// 调用stdin</span></span><br><span class="line">    .read_line(&amp;<span class="keyword">mut</span> guess)  <span class="comment">// 调用stdin的方法read_line获取输入值</span></span><br><span class="line">    .expect(<span class="string">"读取失败"</span>);  <span class="comment">// 如果获取错误打印警告</span></span><br></pre></td></tr></tbody></table></figure>
<p>这三行代码其实是一条语句, 我们之前提到, <code>;</code> 代表一段代码的结束, 所以rust会将这三行合并成一条语句来解析, 所以我们也可以将这三行缩短为, 这样会减少代码的可读性</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">io::stdin().read_line(&amp;<span class="keyword">mut</span> guess).expect(<span class="string">"读取失败"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>这段代码的意思是调用 io 模块的静态方法 stdin, 此方法回传一个实例 stdin, 匹配标准输入控制</p>
<p>然后继续调用实例的 <code>read_line</code> 方法, 此方法对标准输入代码执行 <code>read_line</code> 命令, 来获取使用者的输入信息, 我们还将生成的可变变量 guess 传递进去, 代表将用户输入的结果传递给 guess</p>
<p><code>&amp;</code> 代表这个参数是<strong>引用(reference)</strong> , 这让代码中的多个部分共享一个值, 不需要每次都复制值到一个新的地址, 引用是个复杂的概念, rust 可以让你安全又轻松的使用引用, 这个之后再讲, 你现在需要知道的是, 引用默认也是<strong>不可变</strong>的, 因此在后面加上 <code>mut</code> 代表这个是<strong>可变引用</strong>, 因此你必须写 <code>&amp;mut guess</code> 而不是 <code>&amp;guess</code></p>
<p><strong>使用Result类型处理可能出现的错误</strong></p>
<p><code>.expect("读取失败");</code> 这个代码处理了 <code>read_line</code> 方法可能出现的错误, 因为 <code>read_line</code> 返回了 <code>io::Result</code> 对象, 在 rust 中有很多库都有 <code>Result</code>类, Result实际上是种<strong>枚举(enumerations/enums)</strong>, 枚举是拥有固定的值的类型, 这些值被称为枚举的<strong>变体(variants)</strong>, 对于<code>Result</code> 来说, 变体有 <code>ok</code> 和 <code>Error</code>, ok代表成功, error 代表失败, 返回 Result 的目的是让使用者在错误发生时去处理这个问题, <code>io::Result</code> 自带了方法 <code>expect</code>, 当Result返回 时便会触发 <code>expect</code>, 如果是 ok 则代表没有出现问题, expect 不会对数据进行任何操作</p>
<p>当我们不对 <code>expect</code> 进行捕捉, 我们在编译时就会出现如下警告</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io; <span class="comment">// 引入标准库</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"输入你的猜测数字: "</span>); <span class="comment">// 打印</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> guess = <span class="built_in">String</span>::new(); <span class="comment">// 创建一个字符串变量guess</span></span><br><span class="line">    io::stdin() <span class="comment">// 调用函数stdin</span></span><br><span class="line">        .read_line(&amp;<span class="keyword">mut</span> guess); <span class="comment">// 调用stdin的方法read_line获取输入值</span></span><br><span class="line">        <span class="comment">// .expect("读取失败"); // 如果获取错误打印警告</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"你猜测的数字是: {}"</span>, guess) <span class="comment">// 输出获取到的输入</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
 <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo build</span><br><span class="line">   Compiling guessing_game v0.1.0 (/Users/Work/Code/Rust/student/guessing_game)</span><br><span class="line">warning: unused `std::result::Result` that must be used</span><br><span class="line"> --&gt; src/main.rs:6:5</span><br><span class="line">  |</span><br><span class="line">6 | /     io::stdin() // 调用函数stdin</span><br><span class="line">7 | |         .read_line(&amp;mut guess); // 调用stdin的方法read_line获取输入值</span><br><span class="line">  | |_______________________________^</span><br><span class="line">  |</span><br><span class="line">  = note: `<span class="comment">#[warn(unused_must_use)]` on by default</span></span><br><span class="line">  = note: this `Result` may be an `Err` variant, <span class="built_in">which</span> should be handled</span><br><span class="line"></span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.62s</span><br></pre></td></tr></tbody></table></figure>
<p>提示你没有处理可能出现的错误, 这里我们先添加 expect 保证其编译时不警告, 至于怎么去使用 expect 我们之后再说</p>
<p><strong>println!打印输入的数字</strong></p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">println!</span>(<span class="string">"你猜测的数字是: {}"</span>, guess) <span class="comment">// 输出获取到的输入</span></span><br></pre></td></tr></tbody></table></figure>
<p>这里是将用户输入的数字打印出来, <code>{}</code>代表占位符, 将 <code>guess</code> 的值填充到 <code>{}</code> 中, <code>{}</code> 可以多个, 例如</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> y = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"x = {} 而且 y = {}"</span>, x, y);</span><br></pre></td></tr></tbody></table></figure>
<p>输出</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = 5 而且 y = 10</span><br></pre></td></tr></tbody></table></figure>
<p><strong>运行第一个部分</strong></p>
<p>显然的, 程序还没有编写完成, 目前只能获取到用户的输入并打印出来</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo run</span><br><span class="line">   Compiling guessing_game v0.1.0 (/Users/Work/Code/Rust/student/guessing_game)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.60s</span><br><span class="line">     Running `target/debug/guessing_game`</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">3</span><br><span class="line">你猜测的数字是: 3</span><br></pre></td></tr></tbody></table></figure>
<h3 id="生成随机的秘密数字">生成随机的秘密数字</h3>
<p>既然是猜谜游戏, 那么系统需要生成一个随机的数字来进行比对决定对错</p>
<p><strong>使用Crate来获取更多功能</strong></p>
<p><a target="_blank" rel="noopener" href="https://crates.io/">crate.io</a> 是rust官方的仓库, 里面是rust各种各样的包(类似Python的pypi), 我们需要使用其中的一个包 <code>rand</code> 来帮助我们生成随机数字</p>
<p>如何将<code>rand</code>添加进我们的项目呢? 我们找到项目根目录下的<code>Cargo.toml</code> 文件, 并编辑</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"guessing_game"</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">"0.1.0"</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">"xx &lt;xx@Outlook.com&gt;"</span>]</span><br><span class="line"><span class="attr">edition</span> = <span class="string">"2018"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">rand</span> = <span class="string">"0.5"</span></span><br></pre></td></tr></tbody></table></figure>
<p>我们在 <code>[dependencies]</code> 下新增包 <code>rand</code> 设置其版本为 <code>0.5 ,这代表限制</code>rand<code>的版本在</code>0.5`中, 避免出现兼容问题</p>
<p>然后我们使用 <code>cargo build</code> 能看到cargo自动下载了我们指定的包, 如果我们指定的包需要依赖其他的包, cargo也会自动帮我们下载(比如下面的 rand_core)</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo build</span><br><span class="line">    Updating crates.io index</span><br><span class="line">  Downloaded rand v0.5.6</span><br><span class="line">  Downloaded rand_core v0.3.1</span><br><span class="line">  ......</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 11.13s</span><br></pre></td></tr></tbody></table></figure>
<p><strong>crate.io受网络影响, 在国内可能会出现通信问题, 可以使用第三方源比如<a target="_blank" rel="noopener" href="http://mirrors.ustc.edu.cn/help/crates.io-index.html">USTC</a></strong></p>
<p><strong>如果你出现Blocking waiting for file lock on package cache错误, 尝试删除 ~/.cargo/.package-cache 文件</strong></p>
<p><strong>通过Cargo.lock确保项目依赖的正确性</strong></p>
<p>当我们通过 cargo 安装新的依赖后, 我们会发现 <code>Cargo.lock</code> 文件也发生了变化, 增加了我们添加的依赖的具体的信息, 比如</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[[package]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"rand"</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">"0.5.6"</span></span><br><span class="line"><span class="attr">source</span> = <span class="string">"registry+https://github.com/rust-lang/crates.io-index"</span></span><br><span class="line"><span class="attr">checksum</span> = <span class="string">"c618c47cd3ebd209790115ab837de41425723956ad3ce2e6a7f09890947cacb9"</span></span><br><span class="line"><span class="attr">dependencies</span> = [</span><br><span class="line"> <span class="string">"cloudabi"</span>,</span><br><span class="line"> <span class="string">"fuchsia-cprng"</span>,</span><br><span class="line"> <span class="string">"libc"</span>,</span><br><span class="line"> <span class="string">"rand_core 0.3.1"</span>,</span><br><span class="line"> <span class="string">"winapi"</span>,</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
<p>cargo通过该文件来保证依赖的完整性和准确性, 当我们联合开发时, 只要将 <code>Cargo.lock</code> <code>Cargo.toml</code> 上传至项目中, 通过 <code>cargo build</code> 即可下载同样的依赖</p>
<p><strong>升级Crate依赖</strong></p>
<p>如果依赖有小版本的升级, 这通常是修复BUG和提高性能, 使用 <code>cargo update</code> 可以更新依赖, cargo会根据 <code>cargo.toml</code> 的语义化版本升级兼容该版本的小版本更新, 然后更新 <code>cargo.toml</code> 和 <code>cargo.lock</code> 中的内容</p>
<p>例如 你指定了rand 版本为 <code>rand=0.8</code> 则如果当前的版本是 <code>0.8.3</code> 新版本是 <code>0.8.5</code>会自动更新</p>
<p>如果新版本为 <code>0.9.1</code> 则与你指定的版本不同, 则不更新</p>
<p>如果你想更新到 <code>0.9</code> 版本, 需手动的编辑 toml 文件然后执行 update, 但是因为大版本的更新可能伴随着功能的修改, 必须要在手动升级前确认新版本的兼容性</p>
<p><strong>生成随机数字</strong></p>
<p>修改代码为</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io; <span class="comment">// 引入标准库</span></span><br><span class="line"><span class="keyword">use</span> rand::Rng;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"输入你的猜测数字: "</span>); <span class="comment">// 打印</span></span><br><span class="line">    <span class="keyword">let</span> secret_number = rand::thread_rng().gen_range(<span class="number">1</span>, <span class="number">101</span>);  <span class="comment">// 随机生成一个1-100的数字</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"生成的数字是: {}"</span>, secret_number);  <span class="comment">// 打印生成的数字</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> guess = <span class="built_in">String</span>::new(); <span class="comment">// 创建一个字符串变量guess</span></span><br><span class="line">    io::stdin() <span class="comment">// 调用函数stdin</span></span><br><span class="line">        .read_line(&amp;<span class="keyword">mut</span> guess) <span class="comment">// 调用stdin的方法read_line获取输入值</span></span><br><span class="line">        .expect(<span class="string">"读取失败"</span>); <span class="comment">// 如果获取错误打印警告</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"你猜测的数字是: {}"</span>, guess) <span class="comment">// 输出获取到的输入</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>注意到我们新增了两行代码</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">use</span> rand::Rng;</span><br><span class="line">  ....</span><br><span class="line"><span class="keyword">let</span> secret_number = rand::thread_rng().gen_range(<span class="number">1</span>, <span class="number">101</span>);  <span class="comment">// 随机生成一个1-100的数字</span></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">"生成的数字是: {}"</span>, secret_number);  <span class="comment">// 打印生成的数字</span></span><br></pre></td></tr></tbody></table></figure>
<p>在最开始, 我们引入了新的模块, <code>rand::Rng</code>,  需要注意的是, 我们在下面使用 rand 的时候并没有使用 Rng, 实际上这个 <code>Rng</code> 被称作 <strong>特征(trait)</strong></p>
<p>它定义了数字生成器的工作方法, 必须将其引入才可以正常生成数字, 关于特征的更多情况, 我们之后再做讲解</p>
<p>重要的是生成随机数字这一段, 我们使用 rand包的thread_rng方法, 这会返回一个随机数字的生成器, 以当前的工作进程做为种子, 然后我们调用这个生成器的 gen_range 方法, 这个方法是由我们引入的 <code>Rng</code> 定义的, 他接受两个参数, 最大值和最小值, 我们传入 <code>1, 101</code> 代表生成 <code>1-100</code>的数字, 他是<strong>顾头不顾尾</strong>的, 所以我们要填到101</p>
<p>我们将其打印出来运行, 目的是测试功能是否正常, 事实上程序并未完成</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo run       </span><br><span class="line">   Compiling guessing_game v0.1.0 (/Users/Work/Code/Rust/student/guessing_game)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.51s</span><br><span class="line">     Running `target/debug/guessing_game`</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">生成的数字是: 6</span><br><span class="line">1</span><br><span class="line">你猜测的数字是: 1</span><br></pre></td></tr></tbody></table></figure>
<h3 id="将猜测的数字与生成的数字进行比较">将猜测的数字与生成的数字进行比较</h3>
<p>在上面, 我们生成了数字并获取到了用户输入的数字, 这一步我们将这两个数字进行比较</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io; <span class="comment">// 引入标准库</span></span><br><span class="line"><span class="keyword">use</span> rand::Rng;</span><br><span class="line"><span class="keyword">use</span> std::cmp::Ordering;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"输入你的猜测数字: "</span>); <span class="comment">// 打印</span></span><br><span class="line">    <span class="keyword">let</span> secret_number = rand::thread_rng().gen_range(<span class="number">1</span>, <span class="number">101</span>);  <span class="comment">// 随机生成一个1-100的数字</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"生成的数字是: {}"</span>, secret_number);  <span class="comment">// 打印生成的数字</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> guess = <span class="built_in">String</span>::new(); <span class="comment">// 创建一个字符串变量guess</span></span><br><span class="line">    io::stdin() <span class="comment">// 调用函数stdin</span></span><br><span class="line">        .read_line(&amp;<span class="keyword">mut</span> guess) <span class="comment">// 调用stdin的方法read_line获取输入值</span></span><br><span class="line">        .expect(<span class="string">"读取失败"</span>); <span class="comment">// 如果获取错误打印警告</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"你猜测的数字是: {}"</span>, guess); <span class="comment">// 输出获取到的输入</span></span><br><span class="line">    <span class="keyword">match</span> guess.cmp(&amp;secret_number){</span><br><span class="line">        Ordering::Less =&gt; <span class="built_in">println!</span>(<span class="string">"太小了"</span>),</span><br><span class="line">        Ordering::Greater =&gt; <span class="built_in">println!</span>(<span class="string">"太大了"</span>),</span><br><span class="line">        Ordering::Equal =&gt; <span class="built_in">println!</span>(<span class="string">"正确"</span>),</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>我们先引入了 <code>std::cmp::Ordering</code> , Ordering是一个枚举, 其变体为 <code>Less</code>, <code>Greater</code>, <code>Equal</code>. 当你对两个数字进行比较时会有这三种结果</p>
<p><code>cmp</code>方法会对数字进行比较, 我们传入引用 <code>secret_number</code> , 目的是将 guess 与 secret_number 进行比较, 他会回传我们引入的 Ordering 变体</p>
<p><strong>match</strong></p>
<p>有时候, 我们需要对某个枚举的变体进行分别处理, 比如这里, 我们根据数字比较结果来提示用户数字的范围</p>
<p>所以我们使用 <code>match</code> 语法</p>
<p>match 由**分支(arms)<strong>组成, 每个分支包含一个</strong>模式(pattern)**和他的处理逻辑, 当匹配到这个模式, 就会执行对应的逻辑. 在执行完毕后则退出 math 不再进行下面的匹配,  match的具体细节会在之后讲解</p>
<p>但是我们运行时会发现他会报错</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo run</span><br><span class="line">   Compiling guessing_game v0.<span class="number">1.0</span> (/Users/Work/Code/Rust/student/guessing_game)</span><br><span class="line">error[E0308]: mismatched types</span><br><span class="line">  --&gt; src/main.rs:<span class="number">15</span>:<span class="number">21</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">15</span> |     <span class="keyword">match</span> guess.cmp(&amp;secret_number){</span><br><span class="line">   |                     ^^^^^^^^^^^^^^ expected <span class="class"><span class="keyword">struct</span> `<span class="title">std</span></span>::string::<span class="built_in">String</span>`, found integer</span><br><span class="line">   |</span><br><span class="line">   = note: expected reference `&amp;std::string::<span class="built_in">String</span>`</span><br><span class="line">              found reference `&amp;{integer}`</span><br><span class="line"></span><br><span class="line">error: aborting due to previous error</span><br><span class="line"></span><br><span class="line">For more information about this error, <span class="keyword">try</span> `rustc --explain E0308`.</span><br><span class="line">error: could not compile `guessing_game`.</span><br><span class="line"></span><br><span class="line">To learn more, run the command again with --verbose.</span><br></pre></td></tr></tbody></table></figure>
<p>这是因为, guess的类型是字符串, 而secret_number是数值,这就会导致 <strong>型別無法配對（mismatched types）</strong>, rust是静态类型的语言, 这两个是无法进行直接比较的</p>
<p>关于数值, rust有多个数值类型, 分别为 <code>i32</code>32位元数字, <code>u32</code>无符号32位元数字, <code>i64</code>64位元数字, <code>u64</code>64位无符号元数字等等, 默认的类型为 <code>i32</code>, 因此 secret_number 为 <code>i32</code></p>
<p>同时我们也面临一个问题, 就是用户输入的不是数字怎么办</p>
<p>此时我们需要将guess转换为数字, 让他们可以比较, 将代码修改为</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io; <span class="comment">// 引入标准库</span></span><br><span class="line"><span class="keyword">use</span> rand::Rng;</span><br><span class="line"><span class="keyword">use</span> std::cmp::Ordering;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"输入你的猜测数字: "</span>); <span class="comment">// 打印</span></span><br><span class="line">    <span class="keyword">let</span> secret_number = rand::thread_rng().gen_range(<span class="number">1</span>, <span class="number">101</span>);  <span class="comment">// 随机生成一个1-100的数字</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"生成的数字是: {}"</span>, secret_number);  <span class="comment">// 打印生成的数字</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> guess = <span class="built_in">String</span>::new(); <span class="comment">// 创建一个字符串变量guess</span></span><br><span class="line">    io::stdin() <span class="comment">// 调用函数stdin</span></span><br><span class="line">        .read_line(&amp;<span class="keyword">mut</span> guess) <span class="comment">// 调用stdin的方法read_line获取输入值</span></span><br><span class="line">        .expect(<span class="string">"读取失败"</span>); <span class="comment">// 如果获取错误打印警告</span></span><br><span class="line">    <span class="keyword">let</span> guess: <span class="built_in">u32</span> = guess.trim().parse().expect(<span class="string">"请输入正确的数字"</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"你猜测的数字是: {}"</span>, guess); <span class="comment">// 输出获取到的输入</span></span><br><span class="line">    <span class="keyword">match</span> guess.cmp(&amp;secret_number){</span><br><span class="line">        Ordering::Less =&gt; <span class="built_in">println!</span>(<span class="string">"太小了"</span>),</span><br><span class="line">        Ordering::Greater =&gt; <span class="built_in">println!</span>(<span class="string">"太大了"</span>),</span><br><span class="line">        Ordering::Equal =&gt; <span class="built_in">println!</span>(<span class="string">"正确"</span>),</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>我们添加了一行</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> guess: <span class="built_in">u32</span> = guess.trim().parse().expect(<span class="string">"请输入正确的数字"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>注意到, 之前有定义过 guess 为 string 类型, 这里是将他重新定义为一个<code>u32</code>类型的数值, 这在rust中被称为<strong>遮蔽(shadow)</strong>, 我们遮蔽了原来的guess, 遮蔽让我们可以重复的使用一个变量名, <code>guess.trim()</code>可以去除这个字符串前后的空白和换行, 而<code>.parse()</code>则可以将字符串转换为数值类型, 同时我们捕捉<code>expect</code>, 如果转换失败, 则告诉用户出现错误了, 我们来执行代码</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo run</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.00s</span><br><span class="line">     Running `target/debug/guessing_game`</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">生成的数字是: 54</span><br><span class="line">  1</span><br><span class="line">你猜测的数字是: 1</span><br><span class="line">太小了</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo run</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.00s</span><br><span class="line">     Running `target/debug/guessing_game`</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">生成的数字是: 9</span><br><span class="line">ffff111</span><br><span class="line">thread <span class="string">'main'</span> panicked at <span class="string">'请输入正确的数字: ParseIntError { kind: InvalidDigit }'</span>, src/main.rs:13:22</span><br><span class="line">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span><br></pre></td></tr></tbody></table></figure>
<h3 id="使用户循环输入">使用户循环输入</h3>
<p>目前的程序, 用户输入一次失败后就结束了程序, 为了提升体验, 我们需要让用户可以循环输入</p>
<p><strong>loop</strong></p>
<p>loop语法可以生成一个死循环, 我们将代码修改为</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io; <span class="comment">// 引入标准库</span></span><br><span class="line"><span class="keyword">use</span> rand::Rng;</span><br><span class="line"><span class="keyword">use</span> std::cmp::Ordering;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="keyword">let</span> secret_number = rand::thread_rng().gen_range(<span class="number">1</span>, <span class="number">101</span>);  <span class="comment">// 随机生成一个1-100的数字</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"生成的数字是: {}"</span>, secret_number);  <span class="comment">// 打印生成的数字</span></span><br><span class="line">    <span class="keyword">loop</span>{</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"输入你的猜测数字: "</span>); <span class="comment">// 打印</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> guess = <span class="built_in">String</span>::new(); <span class="comment">// 创建一个字符串变量guess</span></span><br><span class="line">        io::stdin() <span class="comment">// 调用函数stdin</span></span><br><span class="line">            .read_line(&amp;<span class="keyword">mut</span> guess) <span class="comment">// 调用stdin的方法read_line获取输入值</span></span><br><span class="line">            .expect(<span class="string">"读取失败"</span>); <span class="comment">// 如果获取错误打印警告</span></span><br><span class="line">        <span class="keyword">let</span> guess: <span class="built_in">u32</span> = guess.trim().parse().expect(<span class="string">"请输入正确的数字"</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"你猜测的数字是: {}"</span>, guess); <span class="comment">// 输出获取到的输入</span></span><br><span class="line">        <span class="keyword">match</span> guess.cmp(&amp;secret_number){</span><br><span class="line">            Ordering::Less =&gt; <span class="built_in">println!</span>(<span class="string">"太小了"</span>),</span><br><span class="line">            Ordering::Greater =&gt; <span class="built_in">println!</span>(<span class="string">"太大了"</span>),</span><br><span class="line">            Ordering::Equal =&gt; <span class="built_in">println!</span>(<span class="string">"正确"</span>),</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>loop是一个死循环, 因此我们不停的输入数字去比较, 退出的方法只有强制关闭程序比如 <code>ctrl+c</code>, 或者输入一个无法解析为数值的字符串让他报错</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo run</span><br><span class="line">   Compiling guessing_game v0.1.0 (/Users/Work/Code/Rust/student/guessing_game)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.40s</span><br><span class="line">     Running `target/debug/guessing_game`</span><br><span class="line">生成的数字是: 79</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">11</span><br><span class="line">你猜测的数字是: 11</span><br><span class="line">太小了</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">ff</span><br><span class="line">thread <span class="string">'main'</span> panicked at <span class="string">'请输入正确的数字: ParseIntError { kind: InvalidDigit }'</span>, src/main.rs:14:26</span><br><span class="line">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span><br></pre></td></tr></tbody></table></figure>
<p><strong>break</strong></p>
<p>我们需要在用户猜中之后让他结束这个游戏, 使用 <code>break</code> 语法可以退出循环</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io; <span class="comment">// 引入标准库</span></span><br><span class="line"><span class="keyword">use</span> rand::Rng;</span><br><span class="line"><span class="keyword">use</span> std::cmp::Ordering;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="keyword">let</span> secret_number = rand::thread_rng().gen_range(<span class="number">1</span>, <span class="number">101</span>);  <span class="comment">// 随机生成一个1-100的数字</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"生成的数字是: {}"</span>, secret_number);  <span class="comment">// 打印生成的数字</span></span><br><span class="line">    <span class="keyword">loop</span>{</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"输入你的猜测数字: "</span>); <span class="comment">// 打印</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> guess = <span class="built_in">String</span>::new(); <span class="comment">// 创建一个字符串变量guess</span></span><br><span class="line">        io::stdin() <span class="comment">// 调用函数stdin</span></span><br><span class="line">            .read_line(&amp;<span class="keyword">mut</span> guess) <span class="comment">// 调用stdin的方法read_line获取输入值</span></span><br><span class="line">            .expect(<span class="string">"读取失败"</span>); <span class="comment">// 如果获取错误打印警告</span></span><br><span class="line">        <span class="keyword">let</span> guess: <span class="built_in">u32</span> = guess.trim().parse().expect(<span class="string">"请输入正确的数字"</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"你猜测的数字是: {}"</span>, guess); <span class="comment">// 输出获取到的输入</span></span><br><span class="line">        <span class="keyword">match</span> guess.cmp(&amp;secret_number){</span><br><span class="line">            Ordering::Less =&gt; <span class="built_in">println!</span>(<span class="string">"太小了"</span>),</span><br><span class="line">            Ordering::Greater =&gt; <span class="built_in">println!</span>(<span class="string">"太大了"</span>),</span><br><span class="line">            Ordering::Equal =&gt; {</span><br><span class="line">              <span class="built_in">println!</span>(<span class="string">"你猜中了, 游戏结束"</span>);</span><br><span class="line">              <span class="keyword">break</span>;  </span><br><span class="line">            },</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>当猜中时, 使用break退出循环, 因为下面没有代码了,就直接退出</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo run</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.00s</span><br><span class="line">     Running `target/debug/guessing_game`</span><br><span class="line">生成的数字是: 25</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">11</span><br><span class="line">你猜测的数字是: 11</span><br><span class="line">太小了</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">25</span><br><span class="line">你猜测的数字是: 25</span><br><span class="line">你猜中了, 游戏结束</span><br></pre></td></tr></tbody></table></figure>
<p><strong>对错误进行处理</strong></p>
<p>现在, 用户输入一个无法转成数值的字符串会导致程序结束, 我们现在需要处理这个错误, 让他在错误时重新输入, 不让代码结束, 我们应该对每个错误都捕捉处理, 避免程序关闭, 这对每个程序都是一样的</p>
<p>我们将<code>expect</code>的处理变成一个<code>match</code>, 当分支检测到<code>Error</code>时进行特殊的处理</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io; <span class="comment">// 引入标准库</span></span><br><span class="line"><span class="keyword">use</span> rand::Rng;</span><br><span class="line"><span class="keyword">use</span> std::cmp::Ordering;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() {</span><br><span class="line">    <span class="keyword">let</span> secret_number = rand::thread_rng().gen_range(<span class="number">1</span>, <span class="number">101</span>);  <span class="comment">// 随机生成一个1-100的数字</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"生成的数字是: {}"</span>, secret_number);  <span class="comment">// 打印生成的数字</span></span><br><span class="line">    <span class="keyword">loop</span>{</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"输入你的猜测数字: "</span>); <span class="comment">// 打印</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> guess = <span class="built_in">String</span>::new(); <span class="comment">// 创建一个字符串变量guess</span></span><br><span class="line">        io::stdin() <span class="comment">// 调用函数stdin</span></span><br><span class="line">            .read_line(&amp;<span class="keyword">mut</span> guess) <span class="comment">// 调用stdin的方法read_line获取输入值</span></span><br><span class="line">            .expect(<span class="string">"读取失败"</span>); <span class="comment">// 如果获取错误打印警告</span></span><br><span class="line">        <span class="keyword">let</span> guess: <span class="built_in">u32</span> = <span class="keyword">match</span> guess.trim().parse() {</span><br><span class="line">            <span class="literal">Ok</span>(num) =&gt; num,</span><br><span class="line">            <span class="literal">Err</span>(_) =&gt; {</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">"输入了一个无法解析的字符串"</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            },</span><br><span class="line">        };</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"你猜测的数字是: {}"</span>, guess); <span class="comment">// 输出获取到的输入</span></span><br><span class="line">        <span class="keyword">match</span> guess.cmp(&amp;secret_number){</span><br><span class="line">            Ordering::Less =&gt; <span class="built_in">println!</span>(<span class="string">"太小了"</span>),</span><br><span class="line">            Ordering::Greater =&gt; <span class="built_in">println!</span>(<span class="string">"太大了"</span>),</span><br><span class="line">            Ordering::Equal =&gt; {</span><br><span class="line">              <span class="built_in">println!</span>(<span class="string">"你猜中了, 游戏结束"</span>);</span><br><span class="line">              <span class="keyword">break</span>;  </span><br><span class="line">            },</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>我们在上面说过, <code>parse</code>返回一个枚举, 那我们就使用<code>match</code>判断这个枚举的分支, 他会有两种情况, <code>OK</code> 和<code>Err</code>, 如果是<code>OK</code>则代表正确, 我们将回传的<code>num</code>原样返回给<code>guess</code>, 如果<code>Err</code> 代表失败, 在失败时我们就不关心<code>num</code>是什么了, 所以我们使用<code>_</code> 接受, 然后打印告诉用户出现了错误, 使用<strong>break</strong>关键字跳出当前的循环</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜  guessing_game git:(master) ✗ cargo run</span><br><span class="line">   Compiling guessing_game v0.1.0 (/Users/Work/Code/Rust/student/guessing_game)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.44s</span><br><span class="line">     Running `target/debug/guessing_game`</span><br><span class="line">生成的数字是: 82</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">11</span><br><span class="line">你猜测的数字是: 11</span><br><span class="line">太小了</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">ff</span><br><span class="line">输入了一个无法解析的字符串</span><br><span class="line">输入你的猜测数字: </span><br><span class="line">82</span><br><span class="line">你猜测的数字是: 82</span><br><span class="line">你猜中了, 游戏结束</span><br></pre></td></tr></tbody></table></figure>
<p>如果是真实的程序, 应该将程序生成的数值打印去除, 这里保留只是为了方便调试</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Rust程序设计语言(1)</p><p><a href="https://chnmig.github.io/2021/09/04/rust_programming_language(1)/">https://chnmig.github.io/2021/09/04/rust_programming_language(1)/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>ChnMig</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-09-04</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-09-04</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Rust/">Rust</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/09/04/requirements_syntax/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">requirements 语法</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/09/04/rust_programming_language(2)/"><span class="level-item">Rust程序设计语言(2)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://chnmig.github.io/2021/09/04/rust_programming_language(1)/';
            this.page.identifier = '2021/09/04/rust_programming_language(1)/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'chnmig' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#安装"><span class="level-left"><span class="level-item">1</span><span class="level-item">安装</span></span></a></li><li><a class="level is-mobile" href="#VsCode配置插件"><span class="level-left"><span class="level-item">2</span><span class="level-item">VsCode配置插件</span></span></a></li><li><a class="level is-mobile" href="#Hello-world"><span class="level-left"><span class="level-item">3</span><span class="level-item">Hello,world</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#编写与执行"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">编写与执行</span></span></a></li><li><a class="level is-mobile" href="#解析"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">解析</span></span></a></li><li><a class="level is-mobile" href="#编译"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">编译</span></span></a></li></ul></li><li><a class="level is-mobile" href="#hello-cargo"><span class="level-left"><span class="level-item">4</span><span class="level-item">hello, cargo</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#使用cargo建立项目"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">使用cargo建立项目</span></span></a></li><li><a class="level is-mobile" href="#执行cargo"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">执行cargo</span></span></a></li></ul></li><li><a class="level is-mobile" href="#设计猜谜游戏程序"><span class="level-left"><span class="level-item">5</span><span class="level-item">设计猜谜游戏程序</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#建立新项目"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">建立新项目</span></span></a></li><li><a class="level is-mobile" href="#处理用户输入的数字"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">处理用户输入的数字</span></span></a></li><li><a class="level is-mobile" href="#生成随机的秘密数字"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">生成随机的秘密数字</span></span></a></li><li><a class="level is-mobile" href="#将猜测的数字与生成的数字进行比较"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">将猜测的数字与生成的数字进行比较</span></span></a></li><li><a class="level is-mobile" href="#使用户循环输入"><span class="level-left"><span class="level-item">5.5</span><span class="level-item">使用户循环输入</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/logo.gif" alt="ChnMig的个人网站" height="28"></a><p class="is-size-7"><span>&copy; 2021 ChnMig</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ChnMig"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>